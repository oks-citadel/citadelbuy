{
  "broxiva-overview": {
    "dashboard": {
      "id": null,
      "uid": "broxiva-overview",
      "title": "Broxiva Production Overview",
      "tags": ["broxiva", "production", "overview"],
      "timezone": "browser",
      "schemaVersion": 16,
      "version": 1,
      "refresh": "30s",
      "time": {
        "from": "now-6h",
        "to": "now"
      },
      "panels": [
        {
          "id": 1,
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
          "type": "graph",
          "title": "Overall Request Rate (req/s)",
          "targets": [
            {
              "expr": "sum(rate(http_requests_total{namespace=\"broxiva-production\"}[5m])) by (app)",
              "legendFormat": "{{app}}",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "reqps", "label": "Requests/sec"},
            {"format": "short"}
          ],
          "lines": true,
          "fill": 1,
          "linewidth": 2,
          "legend": {
            "show": true,
            "values": true,
            "current": true,
            "avg": true,
            "max": true
          }
        },
        {
          "id": 2,
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
          "type": "graph",
          "title": "Error Rate (%)",
          "targets": [
            {
              "expr": "sum(rate(http_requests_total{namespace=\"broxiva-production\",status=~\"5..\"}[5m])) by (app) / sum(rate(http_requests_total{namespace=\"broxiva-production\"}[5m])) by (app) * 100",
              "legendFormat": "{{app}} errors",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "percent", "label": "Error Rate"},
            {"format": "short"}
          ],
          "lines": true,
          "fill": 1,
          "linewidth": 2,
          "alert": {
            "conditions": [
              {
                "evaluator": {"params": [5], "type": "gt"},
                "operator": {"type": "and"},
                "query": {"params": ["A", "5m", "now"]},
                "reducer": {"params": [], "type": "avg"},
                "type": "query"
              }
            ],
            "executionErrorState": "alerting",
            "frequency": "60s",
            "handler": 1,
            "name": "High Error Rate",
            "noDataState": "no_data",
            "notifications": []
          }
        },
        {
          "id": 3,
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
          "type": "graph",
          "title": "Response Time P95 (seconds)",
          "targets": [
            {
              "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{namespace=\"broxiva-production\"}[5m])) by (app, le))",
              "legendFormat": "{{app}} p95",
              "refId": "A"
            },
            {
              "expr": "histogram_quantile(0.50, sum(rate(http_request_duration_seconds_bucket{namespace=\"broxiva-production\"}[5m])) by (app, le))",
              "legendFormat": "{{app}} p50",
              "refId": "B"
            }
          ],
          "yaxes": [
            {"format": "s", "label": "Duration"},
            {"format": "short"}
          ],
          "lines": true,
          "fill": 0,
          "linewidth": 2
        },
        {
          "id": 4,
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
          "type": "graph",
          "title": "Pod CPU Usage (%)",
          "targets": [
            {
              "expr": "sum(rate(container_cpu_usage_seconds_total{namespace=\"broxiva-production\",pod=~\"broxiva-.*\"}[5m])) by (pod) * 100",
              "legendFormat": "{{pod}}",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "percent", "label": "CPU %"},
            {"format": "short"}
          ],
          "lines": true,
          "fill": 1
        },
        {
          "id": 5,
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
          "type": "graph",
          "title": "Pod Memory Usage (MB)",
          "targets": [
            {
              "expr": "sum(container_memory_usage_bytes{namespace=\"broxiva-production\",pod=~\"broxiva-.*\"}) by (pod) / 1024 / 1024",
              "legendFormat": "{{pod}}",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "mbytes", "label": "Memory"},
            {"format": "short"}
          ],
          "lines": true,
          "fill": 1
        },
        {
          "id": 6,
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16},
          "type": "graph",
          "title": "Pod Restart Count",
          "targets": [
            {
              "expr": "sum(kube_pod_container_status_restarts_total{namespace=\"broxiva-production\"}) by (pod)",
              "legendFormat": "{{pod}}",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "short", "label": "Restarts"},
            {"format": "short"}
          ],
          "bars": true,
          "lines": false
        },
        {
          "id": 7,
          "gridPos": {"h": 4, "w": 6, "x": 0, "y": 24},
          "type": "singlestat",
          "title": "Total Requests (24h)",
          "targets": [
            {
              "expr": "sum(increase(http_requests_total{namespace=\"broxiva-production\"}[24h]))",
              "refId": "A"
            }
          ],
          "format": "short",
          "valueName": "current",
          "sparkline": {
            "show": true,
            "lineColor": "rgb(31, 120, 193)",
            "fillColor": "rgba(31, 120, 193, 0.18)"
          }
        },
        {
          "id": 8,
          "gridPos": {"h": 4, "w": 6, "x": 6, "y": 24},
          "type": "singlestat",
          "title": "Current Error Rate",
          "targets": [
            {
              "expr": "sum(rate(http_requests_total{namespace=\"broxiva-production\",status=~\"5..\"}[5m])) / sum(rate(http_requests_total{namespace=\"broxiva-production\"}[5m])) * 100",
              "refId": "A"
            }
          ],
          "format": "percent",
          "valueName": "current",
          "thresholds": "1,5",
          "colors": ["#299c46", "#e0b400", "#d44a3a"],
          "colorValue": true
        },
        {
          "id": 9,
          "gridPos": {"h": 4, "w": 6, "x": 12, "y": 24},
          "type": "singlestat",
          "title": "Active Pods",
          "targets": [
            {
              "expr": "count(kube_pod_status_phase{namespace=\"broxiva-production\",phase=\"Running\"})",
              "refId": "A"
            }
          ],
          "format": "short",
          "valueName": "current",
          "colorValue": false
        },
        {
          "id": 10,
          "gridPos": {"h": 4, "w": 6, "x": 18, "y": 24},
          "type": "singlestat",
          "title": "Avg Response Time (5m)",
          "targets": [
            {
              "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{namespace=\"broxiva-production\"}[5m])) by (le))",
              "refId": "A"
            }
          ],
          "format": "s",
          "valueName": "current",
          "thresholds": "1,3",
          "colors": ["#299c46", "#e0b400", "#d44a3a"],
          "colorValue": true
        }
      ]
    }
  },
  "broxiva-api-detailed": {
    "dashboard": {
      "id": null,
      "uid": "broxiva-api-detailed",
      "title": "Broxiva API - Detailed Metrics",
      "tags": ["broxiva", "api", "backend"],
      "timezone": "browser",
      "schemaVersion": 16,
      "version": 1,
      "refresh": "30s",
      "time": {
        "from": "now-3h",
        "to": "now"
      },
      "panels": [
        {
          "id": 1,
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
          "type": "graph",
          "title": "Request Rate by Endpoint",
          "targets": [
            {
              "expr": "sum(rate(http_requests_total{job=\"broxiva-api\"}[5m])) by (method, path)",
              "legendFormat": "{{method}} {{path}}",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "reqps", "label": "Requests/sec"},
            {"format": "short"}
          ],
          "legend": {
            "show": true,
            "values": true,
            "current": true,
            "max": true,
            "sort": "current",
            "sortDesc": true
          }
        },
        {
          "id": 2,
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
          "type": "graph",
          "title": "Response Time by Endpoint (P95)",
          "targets": [
            {
              "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{job=\"broxiva-api\"}[5m])) by (method, path, le))",
              "legendFormat": "{{method}} {{path}}",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "s", "label": "Duration"},
            {"format": "short"}
          ]
        },
        {
          "id": 3,
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
          "type": "graph",
          "title": "HTTP Status Codes",
          "targets": [
            {
              "expr": "sum(rate(http_requests_total{job=\"broxiva-api\"}[5m])) by (status)",
              "legendFormat": "HTTP {{status}}",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "reqps"},
            {"format": "short"}
          ],
          "stack": true
        },
        {
          "id": 4,
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
          "type": "graph",
          "title": "Database Query Performance",
          "targets": [
            {
              "expr": "rate(db_query_duration_seconds_sum{job=\"broxiva-api\"}[5m]) / rate(db_query_duration_seconds_count{job=\"broxiva-api\"}[5m])",
              "legendFormat": "Avg query time",
              "refId": "A"
            },
            {
              "expr": "histogram_quantile(0.95, rate(db_query_duration_seconds_bucket{job=\"broxiva-api\"}[5m]))",
              "legendFormat": "P95 query time",
              "refId": "B"
            }
          ],
          "yaxes": [
            {"format": "s"},
            {"format": "short"}
          ]
        },
        {
          "id": 5,
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
          "type": "graph",
          "title": "Database Connection Pool",
          "targets": [
            {
              "expr": "pg_stat_activity_count{namespace=\"broxiva-production\"}",
              "legendFormat": "Active connections",
              "refId": "A"
            },
            {
              "expr": "pg_settings_max_connections{namespace=\"broxiva-production\"}",
              "legendFormat": "Max connections",
              "refId": "B"
            }
          ],
          "yaxes": [
            {"format": "short", "label": "Connections"},
            {"format": "short"}
          ]
        },
        {
          "id": 6,
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16},
          "type": "graph",
          "title": "Cache Hit Rate",
          "targets": [
            {
              "expr": "rate(redis_keyspace_hits_total{namespace=\"broxiva-production\"}[5m]) / (rate(redis_keyspace_hits_total{namespace=\"broxiva-production\"}[5m]) + rate(redis_keyspace_misses_total{namespace=\"broxiva-production\"}[5m])) * 100",
              "legendFormat": "Cache hit rate %",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "percent", "max": 100, "min": 0},
            {"format": "short"}
          ]
        },
        {
          "id": 7,
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 24},
          "type": "graph",
          "title": "API Errors by Type",
          "targets": [
            {
              "expr": "sum(rate(http_requests_total{job=\"broxiva-api\",status=~\"4..|5..\"}[5m])) by (status, path)",
              "legendFormat": "{{status}} {{path}}",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "reqps"},
            {"format": "short"}
          ]
        }
      ]
    }
  },
  "broxiva-infrastructure": {
    "dashboard": {
      "id": null,
      "uid": "broxiva-infrastructure",
      "title": "Broxiva Infrastructure Metrics",
      "tags": ["broxiva", "infrastructure", "kubernetes"],
      "timezone": "browser",
      "schemaVersion": 16,
      "version": 1,
      "refresh": "1m",
      "time": {
        "from": "now-6h",
        "to": "now"
      },
      "panels": [
        {
          "id": 1,
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
          "type": "graph",
          "title": "Node CPU Usage",
          "targets": [
            {
              "expr": "100 - (avg by (instance) (rate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
              "legendFormat": "{{instance}}",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "percent", "max": 100, "min": 0},
            {"format": "short"}
          ]
        },
        {
          "id": 2,
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
          "type": "graph",
          "title": "Node Memory Usage",
          "targets": [
            {
              "expr": "(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100",
              "legendFormat": "{{instance}}",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "percent", "max": 100, "min": 0},
            {"format": "short"}
          ]
        },
        {
          "id": 3,
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
          "type": "graph",
          "title": "Disk Usage",
          "targets": [
            {
              "expr": "(1 - (node_filesystem_avail_bytes / node_filesystem_size_bytes)) * 100",
              "legendFormat": "{{instance}} - {{mountpoint}}",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "percent", "max": 100, "min": 0},
            {"format": "short"}
          ]
        },
        {
          "id": 4,
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
          "type": "graph",
          "title": "Network I/O",
          "targets": [
            {
              "expr": "rate(node_network_receive_bytes_total[5m])",
              "legendFormat": "{{instance}} - receive",
              "refId": "A"
            },
            {
              "expr": "rate(node_network_transmit_bytes_total[5m])",
              "legendFormat": "{{instance}} - transmit",
              "refId": "B"
            }
          ],
          "yaxes": [
            {"format": "Bps"},
            {"format": "short"}
          ]
        },
        {
          "id": 5,
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
          "type": "graph",
          "title": "PostgreSQL Connections",
          "targets": [
            {
              "expr": "pg_stat_activity_count",
              "legendFormat": "Active connections",
              "refId": "A"
            }
          ],
          "yaxes": [
            {"format": "short"},
            {"format": "short"}
          ]
        },
        {
          "id": 6,
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16},
          "type": "graph",
          "title": "Redis Memory",
          "targets": [
            {
              "expr": "redis_memory_used_bytes / 1024 / 1024",
              "legendFormat": "Used (MB)",
              "refId": "A"
            },
            {
              "expr": "redis_memory_max_bytes / 1024 / 1024",
              "legendFormat": "Max (MB)",
              "refId": "B"
            }
          ],
          "yaxes": [
            {"format": "mbytes"},
            {"format": "short"}
          ]
        },
        {
          "id": 7,
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 24},
          "type": "graph",
          "title": "Elasticsearch Cluster Health",
          "targets": [
            {
              "expr": "elasticsearch_cluster_health_number_of_nodes",
              "legendFormat": "Nodes",
              "refId": "A"
            },
            {
              "expr": "elasticsearch_cluster_health_active_shards",
              "legendFormat": "Active shards",
              "refId": "B"
            },
            {
              "expr": "elasticsearch_cluster_health_relocating_shards",
              "legendFormat": "Relocating shards",
              "refId": "C"
            },
            {
              "expr": "elasticsearch_cluster_health_unassigned_shards",
              "legendFormat": "Unassigned shards",
              "refId": "D"
            }
          ],
          "yaxes": [
            {"format": "short"},
            {"format": "short"}
          ]
        }
      ]
    }
  }
}
