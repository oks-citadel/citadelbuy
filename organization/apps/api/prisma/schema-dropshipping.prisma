// ============================================
// GLOBAL DROPSHIPPING ENGINE - DATABASE SCHEMA
// Extension to existing CitadelBuy schema
// ============================================

// ============================================
// SUPPLIER MANAGEMENT
// ============================================

enum SupplierType {
  ALIEXPRESS
  ALIBABA
  TEMU
  BANGGOOD
  SPOCKET
  SYNCEE
  MODALYST
  WHOLESALE2B
  PRINTFUL
  PRINTIFY
  GELATO
  AOPPLUS
  SPRING
  CJDROPSHIPPING
  ZENDROP
  AUTODS
  INVENTORY_SOURCE
  DROPIFIED
  JUMIA
  KONGA
  TAKEALOT
  SHOPAMAGIC
  EXPERTNAIRE
  CUSTOM_API
}

enum SupplierRegion {
  CHINA
  US
  EU
  UK
  AFRICA
  ASIA_PACIFIC
  MIDDLE_EAST
  LATIN_AMERICA
  GLOBAL
}

enum SupplierStatus {
  PENDING_VERIFICATION
  ACTIVE
  SUSPENDED
  DISCONNECTED
  RATE_LIMITED
}

enum FulfillmentType {
  DROPSHIP
  POD
  WHOLESALE
  HYBRID
}

model DropshipSupplier {
  id                    String          @id @default(uuid())
  type                  SupplierType
  name                  String
  displayName           String?
  logo                  String?
  description           String?

  // API Configuration
  apiEndpoint           String?
  apiKey                String?         // Encrypted
  apiSecret             String?         // Encrypted
  accessToken           String?         // Encrypted
  refreshToken          String?         // Encrypted
  tokenExpiresAt        DateTime?
  webhookUrl            String?
  webhookSecret         String?

  // Supplier Details
  region                SupplierRegion  @default(GLOBAL)
  fulfillmentType       FulfillmentType @default(DROPSHIP)
  status                SupplierStatus  @default(PENDING_VERIFICATION)
  isActive              Boolean         @default(true)
  isPODEnabled          Boolean         @default(false)
  isPrivateLabelEnabled Boolean         @default(false)

  // Shipping Configuration
  averageShippingDays   Int             @default(14)
  minShippingDays       Int             @default(7)
  maxShippingDays       Int             @default(30)
  shippingMethods       Json?           // Array of available methods
  warehouseLocations    Json?           // Array of warehouse regions

  // Trust & Performance
  trustScore            Float           @default(0)
  reliabilityScore      Float           @default(0)
  qualityScore          Float           @default(0)
  responseTimeScore     Float           @default(0)
  disputeRate           Float           @default(0)
  returnRate            Float           @default(0)
  onTimeDeliveryRate    Float           @default(100)
  totalOrders           Int             @default(0)
  successfulOrders      Int             @default(0)

  // Rate Limits
  apiRateLimit          Int             @default(100)    // requests per minute
  apiRateLimitWindow    Int             @default(60)     // seconds
  lastApiCall           DateTime?
  apiCallCount          Int             @default(0)

  // Sync Configuration
  syncEnabled           Boolean         @default(true)
  syncIntervalMinutes   Int             @default(60)
  lastInventorySync     DateTime?
  lastPriceSync         DateTime?
  lastCatalogSync       DateTime?

  // Metadata
  supportedCategories   String[]        @default([])
  supportedCurrencies   String[]        @default(["USD"])
  defaultCurrency       String          @default("USD")
  minimumOrderValue     Float?
  maximumOrderValue     Float?

  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt

  // Relations
  products              SupplierProduct[]
  orders                SupplierOrder[]
  inventoryRecords      SupplierInventory[]
  priceHistory          SupplierPriceHistory[]
  syncLogs              SupplierSyncLog[]
  disputes              SupplierDispute[]
  vendorConnections     VendorSupplierConnection[]

  @@unique([type, apiKey])
  @@index([type])
  @@index([region])
  @@index([status])
  @@index([trustScore])
  @@map("dropship_suppliers")
}

// ============================================
// SUPPLIER PRODUCT CATALOG
// ============================================

enum SupplierProductStatus {
  ACTIVE
  OUT_OF_STOCK
  DISCONTINUED
  PENDING_REVIEW
  REJECTED
  IMPORTED
}

model SupplierProduct {
  id                    String                  @id @default(uuid())
  supplierId            String
  supplier              DropshipSupplier        @relation(fields: [supplierId], references: [id])

  // External IDs
  externalProductId     String                  // Supplier's product ID
  externalSku           String?
  externalUrl           String?

  // Product Information
  title                 String
  description           String?                 @db.Text
  category              String?
  subcategory           String?
  brand                 String?
  manufacturer          String?

  // Media
  images                String[]                @default([])
  videos                String[]                @default([])
  thumbnailUrl          String?

  // Pricing (in supplier's currency)
  supplierCurrency      String                  @default("USD")
  supplierPrice         Float
  supplierOriginalPrice Float?
  supplierShippingCost  Float                   @default(0)
  processingFee         Float                   @default(0)

  // Pricing (converted to platform currency)
  platformCurrency      String                  @default("USD")
  platformCost          Float                   // Total cost including shipping
  suggestedRetailPrice  Float?
  competitorPrice       Float?

  // Inventory
  stockQuantity         Int                     @default(0)
  isInStock             Boolean                 @default(true)
  lowStockThreshold     Int                     @default(10)
  restockDate           DateTime?

  // Variants
  hasVariants           Boolean                 @default(false)
  variantCount          Int                     @default(0)

  // Shipping
  weight                Float?
  weightUnit            String?                 @default("kg")
  dimensions            Json?                   // {length, width, height}
  shippingCategory      String?
  estimatedShippingDays Int?

  // Performance Metrics
  salesCount            Int                     @default(0)
  viewCount             Int                     @default(0)
  importCount           Int                     @default(0)
  conversionRate        Float                   @default(0)
  returnRate            Float                   @default(0)
  averageRating         Float                   @default(0)
  reviewCount           Int                     @default(0)

  // AI Scores
  winningProductScore   Float                   @default(0)
  trendScore            Float                   @default(0)
  profitabilityScore    Float                   @default(0)
  demandScore           Float                   @default(0)
  competitionScore      Float                   @default(0)

  // Status
  status                SupplierProductStatus   @default(ACTIVE)
  isVerified            Boolean                 @default(false)
  isFeatured            Boolean                 @default(false)

  // POD Specific
  isPOD                 Boolean                 @default(false)
  podTemplate           Json?                   // Design template config
  customizableAreas     Json?                   // Areas for customization

  // Metadata
  tags                  String[]                @default([])
  attributes            Json?                   // Custom attributes
  specifications        Json?                   // Technical specs

  // Sync
  lastSyncAt            DateTime?
  syncHash              String?                 // For change detection

  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt

  // Relations
  variants              SupplierProductVariant[]
  mappings              ProductSupplierMapping[]
  priceHistory          SupplierPriceHistory[]
  inventoryHistory      SupplierInventory[]

  @@unique([supplierId, externalProductId])
  @@index([supplierId])
  @@index([status])
  @@index([winningProductScore])
  @@index([category])
  @@map("supplier_products")
}

model SupplierProductVariant {
  id                    String              @id @default(uuid())
  supplierProductId     String
  supplierProduct       SupplierProduct     @relation(fields: [supplierProductId], references: [id], onDelete: Cascade)

  externalVariantId     String
  externalSku           String?

  // Variant Details
  name                  String
  options               Json                // {color: "Red", size: "XL"}

  // Pricing
  supplierPrice         Float
  platformCost          Float

  // Inventory
  stockQuantity         Int                 @default(0)
  isInStock             Boolean             @default(true)

  // Media
  imageUrl              String?

  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  mappings              VariantSupplierMapping[]

  @@unique([supplierProductId, externalVariantId])
  @@index([supplierProductId])
  @@map("supplier_product_variants")
}

// ============================================
// PRODUCT MAPPING (Platform <-> Supplier)
// ============================================

enum MappingStatus {
  ACTIVE
  PAUSED
  OUT_OF_STOCK
  PRICE_CHANGED
  DISCONTINUED
}

model ProductSupplierMapping {
  id                    String              @id @default(uuid())
  productId             String              // Reference to platform Product
  supplierProductId     String
  supplierProduct       SupplierProduct     @relation(fields: [supplierProductId], references: [id])
  vendorId              String              // Vendor who imported this

  // Mapping Configuration
  isDefault             Boolean             @default(false)  // Primary supplier for this product
  priority              Int                 @default(1)      // For multi-supplier routing
  status                MappingStatus       @default(ACTIVE)

  // Pricing Rules
  pricingStrategy       String              @default("MARKUP_PERCENTAGE")
  markupPercentage      Float               @default(30)
  markupFixed           Float?
  minimumMargin         Float               @default(10)
  maximumPrice          Float?
  roundToNearest        Float?              @default(0.99)

  // Auto-sync Settings
  autoSyncInventory     Boolean             @default(true)
  autoSyncPrice         Boolean             @default(true)
  priceProtection       Boolean             @default(true)   // Prevent price drops below cost

  // Fulfillment
  autoFulfill           Boolean             @default(false)
  fulfillmentDelay      Int                 @default(0)      // Hours to wait before auto-fulfill

  // Stats
  ordersPlaced          Int                 @default(0)
  lastOrderAt           DateTime?

  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  variantMappings       VariantSupplierMapping[]

  @@unique([productId, supplierProductId])
  @@index([productId])
  @@index([vendorId])
  @@index([status])
  @@map("product_supplier_mappings")
}

model VariantSupplierMapping {
  id                    String                    @id @default(uuid())
  productMappingId      String
  productMapping        ProductSupplierMapping    @relation(fields: [productMappingId], references: [id], onDelete: Cascade)
  platformVariantId     String                    // Reference to platform ProductVariant
  supplierVariantId     String
  supplierVariant       SupplierProductVariant    @relation(fields: [supplierVariantId], references: [id])

  isActive              Boolean                   @default(true)

  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  @@unique([productMappingId, platformVariantId])
  @@index([productMappingId])
  @@map("variant_supplier_mappings")
}

// ============================================
// VENDOR-SUPPLIER CONNECTIONS
// ============================================

model VendorSupplierConnection {
  id                    String              @id @default(uuid())
  vendorId              String              // Reference to VendorProfile
  supplierId            String
  supplier              DropshipSupplier    @relation(fields: [supplierId], references: [id])

  // Connection Status
  isActive              Boolean             @default(true)
  connectionDate        DateTime            @default(now())

  // Vendor's Credentials for this supplier (if different from global)
  customApiKey          String?             // Encrypted
  customApiSecret       String?             // Encrypted

  // Default Settings for this vendor
  defaultMarkup         Float               @default(30)
  defaultPricingStrategy String             @default("MARKUP_PERCENTAGE")
  autoImportEnabled     Boolean             @default(false)
  autoFulfillEnabled    Boolean             @default(false)

  // Stats
  totalProducts         Int                 @default(0)
  totalOrders           Int                 @default(0)
  totalRevenue          Float               @default(0)

  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  @@unique([vendorId, supplierId])
  @@index([vendorId])
  @@index([supplierId])
  @@map("vendor_supplier_connections")
}

// ============================================
// SUPPLIER ORDERS & FULFILLMENT
// ============================================

enum SupplierOrderStatus {
  PENDING
  SUBMITTED
  ACCEPTED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  FAILED
  REFUNDED
  DISPUTED
}

model SupplierOrder {
  id                    String                @id @default(uuid())
  supplierId            String
  supplier              DropshipSupplier      @relation(fields: [supplierId], references: [id])
  platformOrderId       String                // Reference to platform Order
  platformOrderItemId   String?               // Reference to platform OrderItem
  vendorId              String

  // External Reference
  externalOrderId       String?               // Supplier's order ID
  externalTrackingUrl   String?

  // Order Details
  status                SupplierOrderStatus   @default(PENDING)

  // Cost
  supplierCost          Float
  shippingCost          Float                 @default(0)
  processingFee         Float                 @default(0)
  totalCost             Float
  currency              String                @default("USD")

  // Shipping
  shippingMethod        String?
  estimatedDeliveryDate DateTime?
  actualDeliveryDate    DateTime?

  // Customer Address (for fulfillment)
  shippingAddress       Json

  // Tracking
  trackingNumber        String?
  trackingCarrier       String?
  trackingEvents        Json?                 // Array of tracking events
  lastTrackingUpdate    DateTime?

  // Timestamps
  submittedAt           DateTime?
  acceptedAt            DateTime?
  shippedAt             DateTime?
  deliveredAt           DateTime?
  cancelledAt           DateTime?

  // Error Handling
  lastError             String?
  errorCount            Int                   @default(0)
  retryCount            Int                   @default(0)

  // Notes
  internalNotes         String?
  supplierNotes         String?

  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt

  @@index([supplierId])
  @@index([platformOrderId])
  @@index([vendorId])
  @@index([status])
  @@index([externalOrderId])
  @@map("supplier_orders")
}

// ============================================
// INVENTORY SYNC
// ============================================

model SupplierInventory {
  id                    String              @id @default(uuid())
  supplierId            String
  supplier              DropshipSupplier    @relation(fields: [supplierId], references: [id])
  supplierProductId     String
  supplierProduct       SupplierProduct     @relation(fields: [supplierProductId], references: [id])

  // Stock Levels
  quantity              Int
  previousQuantity      Int?
  reservedQuantity      Int                 @default(0)
  availableQuantity     Int                 // quantity - reservedQuantity

  // Thresholds
  lowStockThreshold     Int                 @default(10)
  outOfStockThreshold   Int                 @default(0)

  // Status
  isInStock             Boolean             @default(true)
  stockStatus           String              @default("IN_STOCK") // IN_STOCK, LOW_STOCK, OUT_OF_STOCK

  // Warehouse
  warehouseId           String?
  warehouseLocation     String?

  // Sync
  lastSyncAt            DateTime            @default(now())
  syncSource            String?             // API, WEBHOOK, MANUAL

  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  @@unique([supplierId, supplierProductId])
  @@index([supplierId])
  @@index([supplierProductId])
  @@index([isInStock])
  @@map("supplier_inventory")
}

// ============================================
// PRICE TRACKING
// ============================================

model SupplierPriceHistory {
  id                    String              @id @default(uuid())
  supplierId            String
  supplier              DropshipSupplier    @relation(fields: [supplierId], references: [id])
  supplierProductId     String
  supplierProduct       SupplierProduct     @relation(fields: [supplierProductId], references: [id])

  // Prices
  price                 Float
  previousPrice         Float?
  priceChange           Float?              // Absolute change
  priceChangePercent    Float?              // Percentage change

  shippingCost          Float               @default(0)
  totalCost             Float

  currency              String              @default("USD")
  exchangeRate          Float               @default(1)

  // Context
  changeReason          String?             // MARKET, PROMOTION, RESTOCK, etc.

  recordedAt            DateTime            @default(now())

  @@index([supplierId])
  @@index([supplierProductId])
  @@index([recordedAt])
  @@map("supplier_price_history")
}

// ============================================
// SYNC LOGS
// ============================================

enum SyncType {
  INVENTORY
  PRICE
  CATALOG
  ORDER
  TRACKING
  FULL
}

enum SyncStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  PARTIAL
}

model SupplierSyncLog {
  id                    String              @id @default(uuid())
  supplierId            String
  supplier              DropshipSupplier    @relation(fields: [supplierId], references: [id])

  syncType              SyncType
  status                SyncStatus          @default(PENDING)

  // Stats
  totalItems            Int                 @default(0)
  processedItems        Int                 @default(0)
  successfulItems       Int                 @default(0)
  failedItems           Int                 @default(0)
  skippedItems          Int                 @default(0)

  // Changes
  itemsCreated          Int                 @default(0)
  itemsUpdated          Int                 @default(0)
  itemsDeleted          Int                 @default(0)
  priceChanges          Int                 @default(0)
  stockChanges          Int                 @default(0)

  // Timing
  startedAt             DateTime            @default(now())
  completedAt           DateTime?
  durationSeconds       Int?

  // Errors
  errorMessage          String?
  errorDetails          Json?

  // Metadata
  triggeredBy           String?             // SCHEDULE, MANUAL, WEBHOOK
  metadata              Json?

  createdAt             DateTime            @default(now())

  @@index([supplierId])
  @@index([syncType])
  @@index([status])
  @@index([startedAt])
  @@map("supplier_sync_logs")
}

// ============================================
// DISPUTES & CLAIMS
// ============================================

enum DisputeType {
  QUALITY_ISSUE
  WRONG_ITEM
  NOT_DELIVERED
  DAMAGED
  LATE_DELIVERY
  PRICE_DISCREPANCY
  OTHER
}

enum DisputeStatus {
  OPEN
  UNDER_REVIEW
  ESCALATED
  RESOLVED
  CLOSED
  REFUNDED
}

model SupplierDispute {
  id                    String              @id @default(uuid())
  supplierId            String
  supplier              DropshipSupplier    @relation(fields: [supplierId], references: [id])
  supplierOrderId       String?
  vendorId              String

  // Dispute Details
  type                  DisputeType
  status                DisputeStatus       @default(OPEN)
  priority              Int                 @default(1)       // 1-5

  // Description
  title                 String
  description           String              @db.Text
  evidence              String[]            @default([])      // URLs to images/documents

  // Resolution
  resolution            String?
  resolutionNotes       String?
  refundAmount          Float?
  refundedAt            DateTime?

  // Communication
  supplierResponse      String?
  lastMessageAt         DateTime?

  // Timestamps
  openedAt              DateTime            @default(now())
  escalatedAt           DateTime?
  resolvedAt            DateTime?
  closedAt              DateTime?

  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  @@index([supplierId])
  @@index([vendorId])
  @@index([status])
  @@map("supplier_disputes")
}

// ============================================
// POD (PRINT ON DEMAND) SPECIFIC
// ============================================

model PODDesign {
  id                    String              @id @default(uuid())
  vendorId              String
  name                  String

  // Design Files
  designUrl             String              // High-res design file
  thumbnailUrl          String?
  previewImages         String[]            @default([])

  // Canvas Settings
  canvasWidth           Int
  canvasHeight          Int
  dpi                   Int                 @default(300)

  // Design Elements
  layers                Json                // Design layers data
  printAreas            Json?               // Printable areas configuration

  // Metadata
  tags                  String[]            @default([])
  category              String?

  isPublic              Boolean             @default(false)

  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  mockups               PODMockup[]
  productDesigns        PODProductDesign[]

  @@index([vendorId])
  @@map("pod_designs")
}

model PODMockup {
  id                    String              @id @default(uuid())
  designId              String
  design                PODDesign           @relation(fields: [designId], references: [id], onDelete: Cascade)

  productType           String              // t-shirt, mug, poster, etc.
  color                 String?

  mockupUrl             String
  thumbnailUrl          String?

  createdAt             DateTime            @default(now())

  @@index([designId])
  @@map("pod_mockups")
}

model PODProductDesign {
  id                    String              @id @default(uuid())
  designId              String
  design                PODDesign           @relation(fields: [designId], references: [id])
  productMappingId      String              // Reference to ProductSupplierMapping

  // Print Configuration
  printArea             String              // front, back, sleeve, etc.
  position              Json                // {x, y, width, height, rotation}

  // Preview
  previewUrl            String?

  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  @@unique([designId, productMappingId, printArea])
  @@index([designId])
  @@map("pod_product_designs")
}

// ============================================
// SAMPLE ORDERS
// ============================================

enum SampleOrderStatus {
  PENDING
  ORDERED
  SHIPPED
  DELIVERED
  REVIEWED
}

model SampleOrder {
  id                    String              @id @default(uuid())
  vendorId              String
  supplierProductId     String

  status                SampleOrderStatus   @default(PENDING)

  // Cost
  sampleCost            Float
  shippingCost          Float               @default(0)
  totalCost             Float

  // Shipping
  shippingAddress       Json
  trackingNumber        String?
  trackingCarrier       String?

  // Review
  qualityRating         Int?                // 1-5
  packagingRating       Int?                // 1-5
  deliveryRating        Int?                // 1-5
  overallRating         Int?                // 1-5
  reviewNotes           String?
  reviewImages          String[]            @default([])

  // Timestamps
  orderedAt             DateTime?
  shippedAt             DateTime?
  deliveredAt           DateTime?
  reviewedAt            DateTime?

  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  @@index([vendorId])
  @@index([status])
  @@map("sample_orders")
}

// ============================================
// AI PRODUCT SCORING
// ============================================

model ProductAIScore {
  id                    String              @id @default(uuid())
  supplierProductId     String              @unique

  // Winning Product Score Components
  overallScore          Float               @default(0)       // 0-100

  // Demand Signals
  demandScore           Float               @default(0)
  searchVolume          Int                 @default(0)
  trendDirection        String?             // UP, DOWN, STABLE
  seasonalityFactor     Float               @default(1)

  // Profitability
  profitabilityScore    Float               @default(0)
  estimatedMargin       Float               @default(0)
  priceCompetitiveness  Float               @default(0)

  // Competition
  competitionScore      Float               @default(0)
  competitorCount       Int                 @default(0)
  marketSaturation      Float               @default(0)

  // Reliability
  supplierScore         Float               @default(0)
  qualityScore          Float               @default(0)
  deliveryScore         Float               @default(0)

  // Social Proof
  socialScore           Float               @default(0)
  reviewSentiment       Float               @default(0)
  viralPotential        Float               @default(0)

  // Conversion Prediction
  predictedConversionRate Float             @default(0)
  predictedDailySales   Int                 @default(0)

  // Recommendations
  recommendedPrice      Float?
  recommendedMarkup     Float?

  // Metadata
  lastCalculatedAt      DateTime            @default(now())
  calculationVersion    String?

  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  @@index([overallScore])
  @@index([demandScore])
  @@map("product_ai_scores")
}

// ============================================
// SHIPPING & WAREHOUSE
// ============================================

model SupplierWarehouse {
  id                    String              @id @default(uuid())
  supplierId            String

  name                  String
  code                  String?

  // Location
  country               String
  countryCode           String
  state                 String?
  city                  String?
  postalCode            String?
  address               String?

  // Coordinates
  latitude              Float?
  longitude             Float?

  // Capabilities
  isActive              Boolean             @default(true)
  supportsFastShipping  Boolean             @default(false)
  supportsLocalShipping Boolean             @default(false)

  // Shipping Times to Regions
  shippingTimes         Json?               // {US: 7, EU: 10, UK: 8, ...}

  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  @@unique([supplierId, code])
  @@index([supplierId])
  @@index([country])
  @@map("supplier_warehouses")
}

// ============================================
// PRICING RULES
// ============================================

enum PricingRuleType {
  MARKUP_PERCENTAGE
  MARKUP_FIXED
  TARGET_MARGIN
  COMPETITIVE
  DYNAMIC
}

model DropshippingPricingRule {
  id                    String              @id @default(uuid())
  vendorId              String
  name                  String

  // Rule Configuration
  ruleType              PricingRuleType     @default(MARKUP_PERCENTAGE)
  isActive              Boolean             @default(true)
  priority              Int                 @default(1)

  // Conditions
  minCost               Float?
  maxCost               Float?
  categories            String[]            @default([])
  suppliers             String[]            @default([])

  // Markup Settings
  markupPercentage      Float?
  markupFixed           Float?
  targetMargin          Float?

  // Price Constraints
  minimumPrice          Float?
  maximumPrice          Float?
  roundTo               Float?              @default(0.99)

  // Dynamic Pricing
  enableDynamicPricing  Boolean             @default(false)
  priceFloor            Float?
  priceCeiling          Float?

  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  @@index([vendorId])
  @@index([isActive])
  @@map("dropshipping_pricing_rules")
}

// ============================================
// ANALYTICS
// ============================================

model DropshippingAnalytics {
  id                    String              @id @default(uuid())
  vendorId              String
  supplierId            String?
  date                  DateTime            @db.Date

  // Orders
  ordersPlaced          Int                 @default(0)
  ordersShipped         Int                 @default(0)
  ordersDelivered       Int                 @default(0)
  ordersCancelled       Int                 @default(0)
  ordersRefunded        Int                 @default(0)

  // Revenue
  grossRevenue          Float               @default(0)
  supplierCosts         Float               @default(0)
  shippingCosts         Float               @default(0)
  netProfit             Float               @default(0)
  profitMargin          Float               @default(0)

  // Performance
  averageDeliveryDays   Float?
  onTimeDeliveryRate    Float?
  returnRate            Float?
  disputeRate           Float?

  // Products
  productsImported      Int                 @default(0)
  productsSold          Int                 @default(0)
  topSellingProducts    Json?               // Array of product IDs

  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  @@unique([vendorId, supplierId, date])
  @@index([vendorId])
  @@index([supplierId])
  @@index([date])
  @@map("dropshipping_analytics")
}
