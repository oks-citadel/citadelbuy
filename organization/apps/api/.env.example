# Broxiva Backend API - Environment Configuration
# =========================================================
# SECURITY NOTICE: This is a template file. DO NOT commit actual secrets!
# Copy this file to .env and replace all placeholder values with real credentials.
# =========================================================

# Application
NODE_ENV=development
PORT=4000
API_PREFIX=/api

# Frontend URL (for CORS and emails)
FRONTEND_URL=http://localhost:3000

# API Base URL (for email tracking pixels, webhook callbacks, external links)
# Example for production: https://api.broxiva.com
# If not set, FRONTEND_URL will be used as fallback
API_URL=http://localhost:4000

# ==================== CORS CONFIGURATION ====================
# CORS Allowed Origins (REQUIRED in production)
#
# Comma-separated list of allowed origins for Cross-Origin Resource Sharing
#
# PRODUCTION EXAMPLE:
# CORS_ALLOWED_ORIGINS=https://broxiva.com,https://www.broxiva.com,https://app.broxiva.com
#
# Note: Vercel preview deployments (e.g., https://broxiva-abc123.vercel.app) are automatically
# allowed in production via regex pattern matching. You don't need to list them explicitly.
#
# DEVELOPMENT EXAMPLE:
# CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:4200
#
# SECURITY NOTES:
# - In production, all origins MUST use HTTPS
# - Do NOT use wildcard (*) - always specify exact origins
# - Include all domains where your frontend/mobile web apps are hosted
# - Vercel preview URLs are auto-allowed for broxiva-*.vercel.app pattern
#
# CORS_ORIGIN is deprecated but still supported for backward compatibility
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:4200

# ==================== DATABASE ====================
# PostgreSQL Database Connection
#
# SECURITY: Never use weak passwords! Generate strong random passwords.
#
# Generate password: openssl rand -base64 32
#
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=public
# Replace PASSWORD with a strong randomly generated password
#
DATABASE_URL="postgresql://broxiva:your-secure-db-password-here-generate-with-openssl@localhost:5432/broxiva_dev?schema=public"

# Redis (Caching & Sessions)
REDIS_URL=redis://localhost:6379

# ==================== JWT AUTHENTICATION ====================
# CRITICAL SECURITY: Generate secure random secrets before deploying!
#
# NEVER use these placeholder values in any environment!
# NEVER commit actual secrets to version control!
#
# How to generate secure secrets:
#   For JWT secrets:     openssl rand -base64 64
#   For encryption keys: openssl rand -hex 32
#
# Requirements:
#   - JWT_SECRET: Minimum 64 characters (base64 encoded)
#   - JWT_REFRESH_SECRET: Minimum 64 characters, MUST be different from JWT_SECRET
#   - Both must be cryptographically random
#
# Example generation:
#   $ openssl rand -base64 64
#   Output: Use this as your JWT_SECRET
#
JWT_SECRET=your-jwt-secret-here-minimum-64-characters-generate-with-openssl-rand-base64-64
JWT_EXPIRES_IN=7d
JWT_REFRESH_SECRET=your-jwt-refresh-secret-here-minimum-64-characters-must-differ-from-jwt-secret
JWT_REFRESH_EXPIRES_IN=30d

# ==================== PAYMENT PROVIDERS ====================

# Stripe (Primary - Global)
STRIPE_ENABLED=true
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret
APPLE_MERCHANT_ID=merchant.com.broxiva
GOOGLE_MERCHANT_ID=BCR2DN4TXXXXXXXX

# PayPal (Secondary - Global)
PAYPAL_ENABLED=true
PAYPAL_CLIENT_ID=your_paypal_client_id
PAYPAL_CLIENT_SECRET=your_paypal_client_secret
PAYPAL_MODE=sandbox
PAYPAL_WEBHOOK_ID=your_webhook_id

# Flutterwave (African Markets - Nigeria, Ghana, Kenya, etc.)
FLUTTERWAVE_ENABLED=false
FLUTTERWAVE_PUBLIC_KEY=FLWPUBK_TEST-xxxx
FLUTTERWAVE_SECRET_KEY=FLWSECK_TEST-xxxx
FLUTTERWAVE_ENCRYPTION_KEY=xxxx
FLUTTERWAVE_WEBHOOK_SECRET=xxxx

# Paystack (Nigeria, Ghana, South Africa, Kenya)
PAYSTACK_ENABLED=false
PAYSTACK_PUBLIC_KEY=pk_test_xxxx
PAYSTACK_SECRET_KEY=sk_test_xxxx

# ==================== IN-APP PURCHASES ====================

# Apple IAP (iOS StoreKit)
APPLE_SHARED_SECRET=your_shared_secret_from_app_store_connect
APPLE_BUNDLE_ID=com.broxiva.app
# For StoreKit 2 Server API (iOS 15+)
APPLE_ISSUER_ID=xxxx-xxxx-xxxx
APPLE_KEY_ID=XXXXXXXXXX
APPLE_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\nXXXX\n-----END PRIVATE KEY-----

# Google Play Billing (Android)
GOOGLE_PACKAGE_NAME=com.broxiva.app
GOOGLE_SERVICE_ACCOUNT_EMAIL=billing@project.iam.gserviceaccount.com
GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\nXXXX\n-----END PRIVATE KEY-----

# Email (SMTP)
EMAIL_HOST=smtp.mailtrap.io
EMAIL_PORT=587
EMAIL_USER=your_smtp_user
EMAIL_PASSWORD=your_smtp_password
EMAIL_FROM=noreply@broxiva.com
SUPPORT_EMAIL=support@broxiva.com

# ==================== STORAGE PROVIDERS ====================

# Storage Provider Selection (S3, AZURE, LOCAL)
STORAGE_PROVIDER=S3
STORAGE_BUCKET=broxiva-kyc-documents

# AWS S3 (File Storage)
# Get from AWS IAM Console: https://console.aws.amazon.com/iam/
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE_CHANGE_ME
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY_CHANGE_ME
AWS_REGION=us-east-1
AWS_S3_BUCKET=broxiva-uploads

# ==================== SOCIAL LOGIN ====================

# Google OAuth (Sign in with Google)
# Get from: https://console.cloud.google.com/apis/credentials
# SECURITY: Required for proper server-side token verification
GOOGLE_CLIENT_ID=CHANGE_ME_YOUR_GOOGLE_OAUTH_CLIENT_ID
GOOGLE_CLIENT_SECRET=CHANGE_ME_YOUR_GOOGLE_OAUTH_CLIENT_SECRET

# Facebook OAuth (Sign in with Facebook)
# Get from: https://developers.facebook.com/apps/
# SECURITY: Required for proper server-side token verification
FACEBOOK_APP_ID=CHANGE_ME_YOUR_FACEBOOK_APP_ID
FACEBOOK_APP_SECRET=CHANGE_ME_YOUR_FACEBOOK_APP_SECRET

# Apple Sign In
# Get from: https://developer.apple.com/account/resources/identifiers/
# SECURITY: Required for proper server-side token verification
APPLE_CLIENT_ID=com.broxiva.app

# GitHub OAuth (Sign in with GitHub)
# Get from: https://github.com/settings/developers
# Create a new OAuth App to get these credentials
# Homepage URL: https://broxiva.com
# Authorization callback URL: https://broxiva.com/auth/github/callback
# SECURITY: Client secret is optional for public clients but recommended for server-side verification
GITHUB_CLIENT_ID=CHANGE_ME_YOUR_GITHUB_OAUTH_CLIENT_ID
GITHUB_CLIENT_SECRET=CHANGE_ME_YOUR_GITHUB_OAUTH_CLIENT_SECRET

# ==================== SECURITY ====================

# ==================== MFA ENFORCEMENT ====================
# Multi-Factor Authentication enforcement settings

# Roles that require mandatory MFA (comma-separated)
# Default: ADMIN,VENDOR
# Options: ADMIN, VENDOR, CUSTOMER, SUPPORT (any valid UserRole)
MFA_REQUIRED_ROLES=ADMIN,VENDOR

# Grace period in days for new users to set up MFA
# Default: 7 (users have 7 days to set up MFA after account creation)
MFA_GRACE_PERIOD_DAYS=7

# Number of days to remember trusted devices
# Default: 30 (devices are trusted for 30 days before requiring MFA again)
MFA_TRUSTED_DEVICE_DAYS=30

# Enable trusted device feature (remember this device)
# Default: true
# Set to false to require MFA on every login
MFA_ENABLE_TRUSTED_DEVICES=true

# ==================== ENCRYPTION ====================
# KYC Encryption Key (CRITICAL: Must be exactly 32 bytes for AES-256)
#
# SECURITY REQUIREMENTS:
#   - Must be EXACTLY 64 hexadecimal characters (32 bytes)
#   - Must be cryptographically random
#   - NEVER reuse across environments
#   - Store in secure secrets manager in production
#
# Generate with: openssl rand -hex 32
# NEVER use the placeholder value in production!
#
# Example:
#   $ openssl rand -hex 32
#   Output: abcd1234... (64 hex chars)
#
KYC_ENCRYPTION_KEY=your-encryption-key-here-exactly-64-hex-chars-32-bytes-openssl-rand-hex-32

# ==================== SEARCH PROVIDERS ====================

# Search Provider Selection
# Options: 'elasticsearch', 'algolia', 'internal', 'auto'
# 'auto' will try Elasticsearch first, then Algolia, then fall back to internal
SEARCH_PROVIDER=auto

# Elasticsearch (Advanced Search)
# Connection settings
ELASTICSEARCH_NODE=http://localhost:9200
ELASTICSEARCH_USERNAME=
ELASTICSEARCH_PASSWORD=
# Index settings
ELASTICSEARCH_INDEX_PREFIX=broxiva
# Sync settings
ELASTICSEARCH_BULK_SIZE=1000
ELASTICSEARCH_REQUEST_TIMEOUT=30000

# Algolia (Alternative Search)
# Get from: https://www.algolia.com/account/api-keys/
ALGOLIA_APP_ID=CHANGE_ME_YOUR_ALGOLIA_APP_ID
ALGOLIA_API_KEY=CHANGE_ME_YOUR_ALGOLIA_ADMIN_API_KEY
ALGOLIA_INDEX_NAME=broxiva_products

# ==================== LLM PROVIDERS ====================
# AI-powered content generation using LLM providers

# OpenAI Configuration
# Get from: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-proj-CHANGE_ME_GET_FROM_OPENAI_PLATFORM
# Optional: OpenAI Organization ID
OPENAI_ORGANIZATION=
# Model to use (default: gpt-4-turbo-preview)
# Options: gpt-4-turbo-preview, gpt-4, gpt-3.5-turbo
OPENAI_MODEL=gpt-4-turbo-preview

# Anthropic Configuration (Claude)
# Get from: https://console.anthropic.com/
ANTHROPIC_API_KEY=sk-ant-CHANGE_ME_GET_FROM_ANTHROPIC_CONSOLE
# Model to use (default: claude-3-5-sonnet-20241022)
# Options: claude-3-5-sonnet-20241022, claude-3-opus-20240229, claude-3-sonnet-20240229, claude-3-haiku-20240307
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022

# LLM Provider Selection
# Primary provider (default: openai)
# Options: openai, anthropic
LLM_PRIMARY_PROVIDER=openai
# Fallback provider (used if primary fails)
# Options: openai, anthropic (or leave empty for no fallback)
LLM_FALLBACK_PROVIDER=anthropic
# Enable template-based fallback when all LLM providers fail (default: true)
LLM_ENABLE_TEMPLATE_FALLBACK=true

# Google Cloud (Vision API for Visual Search)
# Get from: https://console.cloud.google.com/
GOOGLE_CLOUD_PROJECT_ID=CHANGE_ME_YOUR_GCP_PROJECT_ID
GOOGLE_APPLICATION_CREDENTIALS=/path/to/credentials.json

# Facebook Conversions API
# Get from: https://business.facebook.com/
FACEBOOK_PIXEL_ID=CHANGE_ME_YOUR_FACEBOOK_PIXEL_ID
FACEBOOK_ACCESS_TOKEN=CHANGE_ME_YOUR_FACEBOOK_ACCESS_TOKEN

# TikTok Events API
# Get from: https://ads.tiktok.com/
TIKTOK_PIXEL_ID=CHANGE_ME_YOUR_TIKTOK_PIXEL_ID
TIKTOK_ACCESS_TOKEN=CHANGE_ME_YOUR_TIKTOK_ACCESS_TOKEN

# ==================== reCAPTCHA BOT PROTECTION ====================
# Google reCAPTCHA v2/v3 Integration for Bot Protection
#
# Get keys from: https://www.google.com/recaptcha/admin
# Create a new site and select reCAPTCHA v3 (invisible) or v2 (checkbox)
#
# SECURITY:
#   - Use v3 for invisible protection (recommended)
#   - Use v2 checkbox for explicit user verification
#   - Never expose RECAPTCHA_SECRET_KEY to frontend
#
# Site Key (public) - Use this in your frontend
RECAPTCHA_SITE_KEY=CHANGE_ME_YOUR_RECAPTCHA_SITE_KEY

# Secret Key (private) - Keep this secure, server-side only
RECAPTCHA_SECRET_KEY=CHANGE_ME_YOUR_RECAPTCHA_SECRET_KEY

# Score Threshold for reCAPTCHA v3 (0.0 to 1.0)
# Lower values = more permissive, Higher values = more strict
# Recommended: 0.5 for normal protection, 0.7 for high security
# 0.0 = Allow all, 1.0 = Block all except perfect scores
RECAPTCHA_SCORE_THRESHOLD=0.5

# Enable/Disable reCAPTCHA verification globally
# Set to 'false' during development or when testing without reCAPTCHA
RECAPTCHA_ENABLED=true

# Exempt IP addresses (comma-separated)
# These IPs skip reCAPTCHA verification
# Useful for internal services, load balancers, health checks
# Example: 10.0.0.0/8,192.168.1.0/24,internal-service.local
RECAPTCHA_EXEMPT_IPS=

# Cache TTL for verification results (in seconds)
# Prevents duplicate API calls for the same token
# Default: 300 (5 minutes)
RECAPTCHA_CACHE_TTL=300

# ==================== RATE LIMITING ====================
# Comprehensive tiered rate limiting configuration
# Limits are per time window (TTL in seconds)

# Default rate limit (applies when no specific group is matched)
THROTTLE_TTL=60
THROTTLE_LIMIT=100

# Anonymous user rate limits (unauthenticated requests by IP)
# More restrictive than authenticated users
THROTTLE_ANONYMOUS_TTL=60
THROTTLE_ANONYMOUS_LIMIT=30

# Auth endpoint rate limits (login, register, password reset, etc.)
# Very restrictive to prevent brute force attacks
THROTTLE_AUTH_TTL=60
THROTTLE_AUTH_LIMIT=10

# Webhook endpoint rate limits
# Higher limits as webhooks are from trusted sources (Stripe, PayPal, etc.)
THROTTLE_WEBHOOK_TTL=60
THROTTLE_WEBHOOK_LIMIT=100

# AI endpoint rate limits (content generation, visual search, fraud detection)
# Restrictive as AI operations are expensive
THROTTLE_AI_TTL=60
THROTTLE_AI_LIMIT=5

# ==================== RATE LIMIT TIERS BY PLAN ====================
# These are defaults - authenticated users get higher limits based on their plan:
#
# | Plan       | Default API | Auth Endpoints | AI Endpoints |
# |------------|-------------|----------------|--------------|
# | Anonymous  | 30/min      | 10/min         | 5/min        |
# | Free       | 60/min      | 20/min         | 10/min       |
# | Basic      | 120/min     | 30/min         | 30/min       |
# | Premium    | 300/min     | 50/min         | 100/min      |
# | Enterprise | 1000/min    | 100/min        | 500/min      |
#
# Note: Write operations (POST, PUT, DELETE) get 50% of read limits

# Logging
LOG_LEVEL=debug

# Sentry (Error Tracking)
# Get from: https://sentry.io/settings/projects/
SENTRY_DSN=https://CHANGE_ME@o0000000.ingest.sentry.io/0000000

# ==================== ALERT NOTIFICATIONS ====================
# Alert Service Configuration for Critical Failures
#
# Slack Webhook Integration
# Get from: https://api.slack.com/messaging/webhooks
# Create an incoming webhook in your Slack workspace settings
# Format: https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXX
SLACK_WEBHOOK_URL=

# PagerDuty Integration (Optional - for critical alerts only)
# Get from: https://support.pagerduty.com/docs/services-and-integrations
# Create a new service integration and use the Integration Key (routing_key)
# Format: 32-character alphanumeric string
PAGERDUTY_API_KEY=

# Email Alert Recipients (Fallback)
# Comma-separated list of email addresses to receive critical alerts
# Example: ops@broxiva.com,engineering@broxiva.com,admin@broxiva.com
ALERT_EMAIL_RECIPIENTS=

# ==================== KYC VERIFICATION PROCESSOR ====================
# Advanced verification for KYC document processing
# See organization-kyc/.env.example for detailed configuration

# Provider Selection
KYC_OCR_PROVIDER=mock                         # Options: mock, aws_textract, google_vision, azure_vision, tesseract
KYC_FACE_PROVIDER=mock                        # Options: mock, aws_rekognition, azure_face, face_plusplus
KYC_COMPLIANCE_PROVIDER=mock                   # Options: mock, complyadvantage, refinitiv, dowjones, lexisnexis

# Verification Settings
KYC_VERIFICATION_LEVEL=standard                # Options: basic, standard, enhanced
KYC_AUTO_APPROVE_THRESHOLD=0.85               # Auto-approve if score >= this (0.0-1.0)
KYC_MANUAL_REVIEW_THRESHOLD=0.65              # Manual review if score < this (0.0-1.0)

# Feature Flags
KYC_ENABLE_COMPLIANCE_SCREENING=true          # Enable sanctions/PEP screening
KYC_ENABLE_FACE_VERIFICATION=true             # Enable face matching

# Provider API Keys (configure based on selected providers above)
# Google Cloud
GOOGLE_APPLICATION_CREDENTIALS=/path/to/google-credentials.json
GOOGLE_CLOUD_PROJECT_ID=your_gcp_project_id

# Face++
FACEPP_API_KEY=your_facepp_api_key
FACEPP_API_SECRET=your_facepp_api_secret

# Compliance Screening Providers
COMPLYADVANTAGE_API_KEY=your_complyadvantage_api_key
REFINITIV_API_KEY=your_refinitiv_api_key
REFINITIV_API_SECRET=your_refinitiv_api_secret
DOWJONES_API_KEY=your_dowjones_api_key
DOWJONES_API_SECRET=your_dowjones_api_secret
LEXISNEXIS_API_KEY=your_lexisnexis_api_key
LEXISNEXIS_CUSTOMER_ID=your_lexisnexis_customer_id
