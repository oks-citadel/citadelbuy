# Broxiva Backend API - Environment Configuration
# =========================================================
# SECURITY NOTICE: This is a template file. DO NOT commit actual secrets!
# Copy this file to .env and replace all placeholder values with real credentials.
# =========================================================

# Application
NODE_ENV=development
PORT=4000
API_PREFIX=/api

# Frontend URL (for CORS and emails)
FRONTEND_URL=http://localhost:3000

# ==================== DATABASE ====================
# PostgreSQL Database Connection
#
# SECURITY: Never use weak passwords! Generate strong random passwords.
#
# Generate password: openssl rand -base64 32
#
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=public
# Replace PASSWORD with a strong randomly generated password
#
DATABASE_URL="postgresql://broxiva:your-secure-db-password-here-generate-with-openssl@localhost:5432/broxiva_dev?schema=public"

# Redis (Caching & Sessions)
REDIS_URL=redis://localhost:6379

# ==================== JWT AUTHENTICATION ====================
# CRITICAL SECURITY: Generate secure random secrets before deploying!
#
# NEVER use these placeholder values in any environment!
# NEVER commit actual secrets to version control!
#
# How to generate secure secrets:
#   For JWT secrets:     openssl rand -base64 64
#   For encryption keys: openssl rand -hex 32
#
# Requirements:
#   - JWT_SECRET: Minimum 64 characters (base64 encoded)
#   - JWT_REFRESH_SECRET: Minimum 64 characters, MUST be different from JWT_SECRET
#   - Both must be cryptographically random
#
# Example generation:
#   $ openssl rand -base64 64
#   Output: Use this as your JWT_SECRET
#
JWT_SECRET=your-jwt-secret-here-minimum-64-characters-generate-with-openssl-rand-base64-64
JWT_EXPIRES_IN=7d
JWT_REFRESH_SECRET=your-jwt-refresh-secret-here-minimum-64-characters-must-differ-from-jwt-secret
JWT_REFRESH_EXPIRES_IN=30d

# ==================== PAYMENT PROVIDERS ====================

# Stripe (Primary - Global)
STRIPE_ENABLED=true
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret
APPLE_MERCHANT_ID=merchant.com.broxiva
GOOGLE_MERCHANT_ID=BCR2DN4TXXXXXXXX

# PayPal (Secondary - Global)
PAYPAL_ENABLED=true
PAYPAL_CLIENT_ID=your_paypal_client_id
PAYPAL_CLIENT_SECRET=your_paypal_client_secret
PAYPAL_MODE=sandbox
PAYPAL_WEBHOOK_ID=your_webhook_id

# Flutterwave (African Markets - Nigeria, Ghana, Kenya, etc.)
FLUTTERWAVE_ENABLED=false
FLUTTERWAVE_PUBLIC_KEY=FLWPUBK_TEST-xxxx
FLUTTERWAVE_SECRET_KEY=FLWSECK_TEST-xxxx
FLUTTERWAVE_ENCRYPTION_KEY=xxxx
FLUTTERWAVE_WEBHOOK_SECRET=xxxx

# Paystack (Nigeria, Ghana, South Africa, Kenya)
PAYSTACK_ENABLED=false
PAYSTACK_PUBLIC_KEY=pk_test_xxxx
PAYSTACK_SECRET_KEY=sk_test_xxxx

# ==================== IN-APP PURCHASES ====================

# Apple IAP (iOS StoreKit)
APPLE_SHARED_SECRET=your_shared_secret_from_app_store_connect
APPLE_BUNDLE_ID=com.broxiva.app
# For StoreKit 2 Server API (iOS 15+)
APPLE_ISSUER_ID=xxxx-xxxx-xxxx
APPLE_KEY_ID=XXXXXXXXXX
APPLE_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\nXXXX\n-----END PRIVATE KEY-----

# Google Play Billing (Android)
GOOGLE_PACKAGE_NAME=com.broxiva.app
GOOGLE_SERVICE_ACCOUNT_EMAIL=billing@project.iam.gserviceaccount.com
GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\nXXXX\n-----END PRIVATE KEY-----

# Email (SMTP)
EMAIL_HOST=smtp.mailtrap.io
EMAIL_PORT=587
EMAIL_USER=your_smtp_user
EMAIL_PASSWORD=your_smtp_password
EMAIL_FROM=noreply@broxiva.com
SUPPORT_EMAIL=support@broxiva.com

# ==================== STORAGE PROVIDERS ====================

# Storage Provider Selection (S3, AZURE, LOCAL)
STORAGE_PROVIDER=S3
STORAGE_BUCKET=broxiva-kyc-documents

# AWS S3 (File Storage)
# Get from AWS IAM Console: https://console.aws.amazon.com/iam/
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE_CHANGE_ME
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY_CHANGE_ME
AWS_REGION=us-east-1
AWS_S3_BUCKET=broxiva-uploads

# Azure Blob Storage (Alternative)
# Get from Azure Portal: https://portal.azure.com
AZURE_STORAGE_ACCOUNT_NAME=CHANGE_ME_YOUR_STORAGE_ACCOUNT_NAME
AZURE_STORAGE_ACCOUNT_KEY=CHANGE_ME_YOUR_STORAGE_ACCOUNT_KEY_FROM_AZURE_PORTAL
AZURE_STORAGE_CONTAINER=broxiva-documents

# ==================== SOCIAL LOGIN ====================

# Google OAuth (Sign in with Google)
# Get from: https://console.cloud.google.com/apis/credentials
# SECURITY: Required for proper server-side token verification
GOOGLE_CLIENT_ID=CHANGE_ME_YOUR_GOOGLE_OAUTH_CLIENT_ID
GOOGLE_CLIENT_SECRET=CHANGE_ME_YOUR_GOOGLE_OAUTH_CLIENT_SECRET

# Facebook OAuth (Sign in with Facebook)
# Get from: https://developers.facebook.com/apps/
# SECURITY: Required for proper server-side token verification
FACEBOOK_APP_ID=CHANGE_ME_YOUR_FACEBOOK_APP_ID
FACEBOOK_APP_SECRET=CHANGE_ME_YOUR_FACEBOOK_APP_SECRET

# Apple Sign In
# Get from: https://developer.apple.com/account/resources/identifiers/
# SECURITY: Required for proper server-side token verification
APPLE_CLIENT_ID=com.broxiva.app

# GitHub OAuth (Sign in with GitHub)
# Get from: https://github.com/settings/developers
# Create a new OAuth App to get these credentials
# Homepage URL: https://broxiva.com
# Authorization callback URL: https://broxiva.com/auth/github/callback
# SECURITY: Client secret is optional for public clients but recommended for server-side verification
GITHUB_CLIENT_ID=CHANGE_ME_YOUR_GITHUB_OAUTH_CLIENT_ID
GITHUB_CLIENT_SECRET=CHANGE_ME_YOUR_GITHUB_OAUTH_CLIENT_SECRET

# ==================== SECURITY ====================

# ==================== ENCRYPTION ====================
# KYC Encryption Key (CRITICAL: Must be exactly 32 bytes for AES-256)
#
# SECURITY REQUIREMENTS:
#   - Must be EXACTLY 64 hexadecimal characters (32 bytes)
#   - Must be cryptographically random
#   - NEVER reuse across environments
#   - Store in secure secrets manager in production
#
# Generate with: openssl rand -hex 32
# NEVER use the placeholder value in production!
#
# Example:
#   $ openssl rand -hex 32
#   Output: abcd1234... (64 hex chars)
#
KYC_ENCRYPTION_KEY=your-encryption-key-here-exactly-64-hex-chars-32-bytes-openssl-rand-hex-32

# ==================== SEARCH PROVIDERS ====================

# Search Provider Selection
# Options: 'elasticsearch', 'algolia', 'internal', 'auto'
# 'auto' will try Elasticsearch first, then Algolia, then fall back to internal
SEARCH_PROVIDER=auto

# Elasticsearch (Advanced Search)
# Connection settings
ELASTICSEARCH_NODE=http://localhost:9200
ELASTICSEARCH_USERNAME=
ELASTICSEARCH_PASSWORD=
# Index settings
ELASTICSEARCH_INDEX_PREFIX=broxiva
# Sync settings
ELASTICSEARCH_BULK_SIZE=1000
ELASTICSEARCH_REQUEST_TIMEOUT=30000

# Algolia (Alternative Search)
# Get from: https://www.algolia.com/account/api-keys/
ALGOLIA_APP_ID=CHANGE_ME_YOUR_ALGOLIA_APP_ID
ALGOLIA_API_KEY=CHANGE_ME_YOUR_ALGOLIA_ADMIN_API_KEY
ALGOLIA_INDEX_NAME=broxiva_products

# OpenAI (AI Features)
# Get from: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-proj-CHANGE_ME_GET_FROM_OPENAI_PLATFORM

# Google Cloud (Vision API for Visual Search)
# Get from: https://console.cloud.google.com/
GOOGLE_CLOUD_PROJECT_ID=CHANGE_ME_YOUR_GCP_PROJECT_ID
GOOGLE_APPLICATION_CREDENTIALS=/path/to/credentials.json

# Facebook Conversions API
# Get from: https://business.facebook.com/
FACEBOOK_PIXEL_ID=CHANGE_ME_YOUR_FACEBOOK_PIXEL_ID
FACEBOOK_ACCESS_TOKEN=CHANGE_ME_YOUR_FACEBOOK_ACCESS_TOKEN

# TikTok Events API
# Get from: https://ads.tiktok.com/
TIKTOK_PIXEL_ID=CHANGE_ME_YOUR_TIKTOK_PIXEL_ID
TIKTOK_ACCESS_TOKEN=CHANGE_ME_YOUR_TIKTOK_ACCESS_TOKEN

# ==================== reCAPTCHA BOT PROTECTION ====================
# Google reCAPTCHA v2/v3 Integration for Bot Protection
#
# Get keys from: https://www.google.com/recaptcha/admin
# Create a new site and select reCAPTCHA v3 (invisible) or v2 (checkbox)
#
# SECURITY:
#   - Use v3 for invisible protection (recommended)
#   - Use v2 checkbox for explicit user verification
#   - Never expose RECAPTCHA_SECRET_KEY to frontend
#
# Site Key (public) - Use this in your frontend
RECAPTCHA_SITE_KEY=CHANGE_ME_YOUR_RECAPTCHA_SITE_KEY

# Secret Key (private) - Keep this secure, server-side only
RECAPTCHA_SECRET_KEY=CHANGE_ME_YOUR_RECAPTCHA_SECRET_KEY

# Score Threshold for reCAPTCHA v3 (0.0 to 1.0)
# Lower values = more permissive, Higher values = more strict
# Recommended: 0.5 for normal protection, 0.7 for high security
# 0.0 = Allow all, 1.0 = Block all except perfect scores
RECAPTCHA_SCORE_THRESHOLD=0.5

# Enable/Disable reCAPTCHA verification globally
# Set to 'false' during development or when testing without reCAPTCHA
RECAPTCHA_ENABLED=true

# Exempt IP addresses (comma-separated)
# These IPs skip reCAPTCHA verification
# Useful for internal services, load balancers, health checks
# Example: 10.0.0.0/8,192.168.1.0/24,internal-service.local
RECAPTCHA_EXEMPT_IPS=

# Cache TTL for verification results (in seconds)
# Prevents duplicate API calls for the same token
# Default: 300 (5 minutes)
RECAPTCHA_CACHE_TTL=300

# Rate Limiting
THROTTLE_TTL=60
THROTTLE_LIMIT=100

# Logging
LOG_LEVEL=debug

# Sentry (Error Tracking)
# Get from: https://sentry.io/settings/projects/
SENTRY_DSN=https://CHANGE_ME@o0000000.ingest.sentry.io/0000000

# ==================== ALERT NOTIFICATIONS ====================
# Alert Service Configuration for Critical Failures
#
# Slack Webhook Integration
# Get from: https://api.slack.com/messaging/webhooks
# Create an incoming webhook in your Slack workspace settings
# Format: https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXX
SLACK_WEBHOOK_URL=

# PagerDuty Integration (Optional - for critical alerts only)
# Get from: https://support.pagerduty.com/docs/services-and-integrations
# Create a new service integration and use the Integration Key (routing_key)
# Format: 32-character alphanumeric string
PAGERDUTY_API_KEY=

# Email Alert Recipients (Fallback)
# Comma-separated list of email addresses to receive critical alerts
# Example: ops@broxiva.com,engineering@broxiva.com,admin@broxiva.com
ALERT_EMAIL_RECIPIENTS=

# ==================== KYC VERIFICATION PROCESSOR ====================
# Advanced verification for KYC document processing
# See organization-kyc/.env.example for detailed configuration

# Provider Selection
KYC_OCR_PROVIDER=mock                         # Options: mock, aws_textract, google_vision, azure_vision, tesseract
KYC_FACE_PROVIDER=mock                        # Options: mock, aws_rekognition, azure_face, face_plusplus
KYC_COMPLIANCE_PROVIDER=mock                   # Options: mock, complyadvantage, refinitiv, dowjones, lexisnexis

# Verification Settings
KYC_VERIFICATION_LEVEL=standard                # Options: basic, standard, enhanced
KYC_AUTO_APPROVE_THRESHOLD=0.85               # Auto-approve if score >= this (0.0-1.0)
KYC_MANUAL_REVIEW_THRESHOLD=0.65              # Manual review if score < this (0.0-1.0)

# Feature Flags
KYC_ENABLE_COMPLIANCE_SCREENING=true          # Enable sanctions/PEP screening
KYC_ENABLE_FACE_VERIFICATION=true             # Enable face matching

# Provider API Keys (configure based on selected providers above)
# Google Cloud
GOOGLE_APPLICATION_CREDENTIALS=/path/to/google-credentials.json
GOOGLE_CLOUD_PROJECT_ID=your_gcp_project_id

# Azure Cognitive Services
AZURE_COMPUTER_VISION_KEY=your_azure_computer_vision_key
AZURE_COMPUTER_VISION_ENDPOINT=https://your-region.api.cognitive.microsoft.com
AZURE_FACE_KEY=your_azure_face_api_key
AZURE_FACE_ENDPOINT=https://your-region.api.cognitive.microsoft.com

# Face++
FACEPP_API_KEY=your_facepp_api_key
FACEPP_API_SECRET=your_facepp_api_secret

# Compliance Screening Providers
COMPLYADVANTAGE_API_KEY=your_complyadvantage_api_key
REFINITIV_API_KEY=your_refinitiv_api_key
REFINITIV_API_SECRET=your_refinitiv_api_secret
DOWJONES_API_KEY=your_dowjones_api_key
DOWJONES_API_SECRET=your_dowjones_api_secret
LEXISNEXIS_API_KEY=your_lexisnexis_api_key
LEXISNEXIS_CUSTOMER_ID=your_lexisnexis_customer_id
