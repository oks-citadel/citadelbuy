{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import React from'react';import{StatusBar}from'expo-status-bar';import{SafeAreaProvider}from'react-native-safe-area-context';import{QueryClient,QueryClientProvider}from'@tanstack/react-query';import{GestureHandlerRootView}from'react-native-gesture-handler';import{NavigationContainer}from'@react-navigation/native';import RootNavigator from'./src/navigation/RootNavigator';import{useAuthStore}from'./src/stores/auth-store';import{ErrorBoundary}from'./src/components/ErrorBoundary';import{errorReporting}from'./src/lib/error-reporting';import{billingService}from'./src/services/billing';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";var queryClient=new QueryClient({defaultOptions:{queries:{staleTime:1000*60*5,retry:2}}});export default function App(){var _useAuthStore=useAuthStore(),checkAuth=_useAuthStore.checkAuth,user=_useAuthStore.user,isAuthenticated=_useAuthStore.isAuthenticated;var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),servicesInitialized=_React$useState2[0],setServicesInitialized=_React$useState2[1];React.useEffect(function(){var initializeServices=function(){var _ref=_asyncToGenerator(function*(){try{console.log('[App] Initializing services...');errorReporting.initialize();console.log('[App] Error reporting initialized');yield billingService.initialize();console.log('[App] Billing service initialized');setServicesInitialized(true);console.log('[App] All services initialized successfully');}catch(error){console.error('[App] Failed to initialize services:',error);setServicesInitialized(true);}});return function initializeServices(){return _ref.apply(this,arguments);};}();initializeServices();return function(){console.log('[App] Cleaning up services...');billingService.disconnect().catch(function(err){console.error('[App] Failed to disconnect billing service:',err);});};},[]);React.useEffect(function(){if(servicesInitialized){checkAuth();}},[servicesInitialized]);React.useEffect(function(){if(isAuthenticated&&user){errorReporting.setUser({id:user.id,email:user.email,username:user.name,name:user.name});console.log('[App] User context set for error reporting:',user.email);}else{errorReporting.clearUser();console.log('[App] User context cleared for error reporting');}},[isAuthenticated,user]);return _jsx(ErrorBoundary,{componentName:\"App\",children:_jsx(GestureHandlerRootView,{style:{flex:1},children:_jsx(QueryClientProvider,{client:queryClient,children:_jsx(SafeAreaProvider,{children:_jsxs(NavigationContainer,{children:[_jsx(StatusBar,{style:\"auto\"}),_jsx(RootNavigator,{})]})})})})});}","map":{"version":3,"names":["React","StatusBar","SafeAreaProvider","QueryClient","QueryClientProvider","GestureHandlerRootView","NavigationContainer","RootNavigator","useAuthStore","ErrorBoundary","errorReporting","billingService","jsx","_jsx","jsxs","_jsxs","queryClient","defaultOptions","queries","staleTime","retry","App","_useAuthStore","checkAuth","user","isAuthenticated","_React$useState","useState","_React$useState2","_slicedToArray","servicesInitialized","setServicesInitialized","useEffect","initializeServices","_ref","_asyncToGenerator","console","log","initialize","error","apply","arguments","disconnect","catch","err","setUser","id","email","username","name","clearUser","componentName","children","style","flex","client"],"sources":["C:/Users/Dell/OneDrive/Documents/Citadelbuy/CitadelBuy/organization/apps/mobile/App.tsx"],"sourcesContent":["import React from 'react';\r\nimport { StatusBar } from 'expo-status-bar';\r\nimport { SafeAreaProvider } from 'react-native-safe-area-context';\r\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\r\nimport { GestureHandlerRootView } from 'react-native-gesture-handler';\r\nimport { NavigationContainer } from '@react-navigation/native';\r\nimport RootNavigator from './src/navigation/RootNavigator';\r\nimport { useAuthStore } from './src/stores/auth-store';\r\nimport { ErrorBoundary } from './src/components/ErrorBoundary';\r\nimport { errorReporting } from './src/lib/error-reporting';\r\nimport { billingService } from './src/services/billing';\r\n\r\nconst queryClient = new QueryClient({\r\n  defaultOptions: {\r\n    queries: {\r\n      staleTime: 1000 * 60 * 5, // 5 minutes\r\n      retry: 2,\r\n    },\r\n  },\r\n});\r\n\r\nexport default function App() {\r\n  const { checkAuth, user, isAuthenticated } = useAuthStore();\r\n  const [servicesInitialized, setServicesInitialized] = React.useState(false);\r\n\r\n  // Initialize error reporting and billing services on app startup\r\n  React.useEffect(() => {\r\n    const initializeServices = async () => {\r\n      try {\r\n        console.log('[App] Initializing services...');\r\n\r\n        // Initialize error reporting (Sentry)\r\n        errorReporting.initialize();\r\n        console.log('[App] Error reporting initialized');\r\n\r\n        // Initialize billing service (IAP)\r\n        await billingService.initialize();\r\n        console.log('[App] Billing service initialized');\r\n\r\n        setServicesInitialized(true);\r\n        console.log('[App] All services initialized successfully');\r\n      } catch (error) {\r\n        console.error('[App] Failed to initialize services:', error);\r\n        // Still set initialized to true to allow app to load\r\n        setServicesInitialized(true);\r\n      }\r\n    };\r\n\r\n    initializeServices();\r\n\r\n    // Cleanup on app unmount\r\n    return () => {\r\n      console.log('[App] Cleaning up services...');\r\n      billingService.disconnect().catch((err) => {\r\n        console.error('[App] Failed to disconnect billing service:', err);\r\n      });\r\n    };\r\n  }, []);\r\n\r\n  // Check authentication after services are initialized\r\n  React.useEffect(() => {\r\n    if (servicesInitialized) {\r\n      checkAuth();\r\n    }\r\n  }, [servicesInitialized]);\r\n\r\n  // Update error reporting user context when authentication state changes\r\n  React.useEffect(() => {\r\n    if (isAuthenticated && user) {\r\n      // Set user context for error reporting\r\n      errorReporting.setUser({\r\n        id: user.id,\r\n        email: user.email,\r\n        username: user.name,\r\n        name: user.name,\r\n      });\r\n      console.log('[App] User context set for error reporting:', user.email);\r\n    } else {\r\n      // Clear user context on logout\r\n      errorReporting.clearUser();\r\n      console.log('[App] User context cleared for error reporting');\r\n    }\r\n  }, [isAuthenticated, user]);\r\n\r\n  return (\r\n    <ErrorBoundary componentName=\"App\">\r\n      <GestureHandlerRootView style={{ flex: 1 }}>\r\n        <QueryClientProvider client={queryClient}>\r\n          <SafeAreaProvider>\r\n            <NavigationContainer>\r\n              <StatusBar style=\"auto\" />\r\n              <RootNavigator />\r\n            </NavigationContainer>\r\n          </SafeAreaProvider>\r\n        </QueryClientProvider>\r\n      </GestureHandlerRootView>\r\n    </ErrorBoundary>\r\n  );\r\n}\r\n"],"mappings":"wIAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,OAASC,SAAS,KAAQ,iBAAiB,CAC3C,OAASC,gBAAgB,KAAQ,gCAAgC,CACjE,OAASC,WAAW,CAAEC,mBAAmB,KAAQ,uBAAuB,CACxE,OAASC,sBAAsB,KAAQ,8BAA8B,CACrE,OAASC,mBAAmB,KAAQ,0BAA0B,CAC9D,MAAO,CAAAC,aAAa,KAAM,gCAAgC,CAC1D,OAASC,YAAY,KAAQ,yBAAyB,CACtD,OAASC,aAAa,KAAQ,gCAAgC,CAC9D,OAASC,cAAc,KAAQ,2BAA2B,CAC1D,OAASC,cAAc,KAAQ,wBAAwB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAExD,GAAM,CAAAC,WAAW,CAAG,GAAI,CAAAb,WAAW,CAAC,CAClCc,cAAc,CAAE,CACdC,OAAO,CAAE,CACPC,SAAS,CAAE,IAAI,CAAG,EAAE,CAAG,CAAC,CACxBC,KAAK,CAAE,CACT,CACF,CACF,CAAC,CAAC,CAEF,cAAe,SAAS,CAAAC,GAAGA,CAAA,CAAG,CAC5B,IAAAC,aAAA,CAA6Cd,YAAY,CAAC,CAAC,CAAnDe,SAAS,CAAAD,aAAA,CAATC,SAAS,CAAEC,IAAI,CAAAF,aAAA,CAAJE,IAAI,CAAEC,eAAe,CAAAH,aAAA,CAAfG,eAAe,CACxC,IAAAC,eAAA,CAAsD1B,KAAK,CAAC2B,QAAQ,CAAC,KAAK,CAAC,CAAAC,gBAAA,CAAAC,cAAA,CAAAH,eAAA,IAApEI,mBAAmB,CAAAF,gBAAA,IAAEG,sBAAsB,CAAAH,gBAAA,IAGlD5B,KAAK,CAACgC,SAAS,CAAC,UAAM,CACpB,GAAM,CAAAC,kBAAkB,gBAAAC,IAAA,CAAAC,iBAAA,CAAG,WAAY,CACrC,GAAI,CACFC,OAAO,CAACC,GAAG,CAAC,gCAAgC,CAAC,CAG7C3B,cAAc,CAAC4B,UAAU,CAAC,CAAC,CAC3BF,OAAO,CAACC,GAAG,CAAC,mCAAmC,CAAC,CAGhD,KAAM,CAAA1B,cAAc,CAAC2B,UAAU,CAAC,CAAC,CACjCF,OAAO,CAACC,GAAG,CAAC,mCAAmC,CAAC,CAEhDN,sBAAsB,CAAC,IAAI,CAAC,CAC5BK,OAAO,CAACC,GAAG,CAAC,6CAA6C,CAAC,CAC5D,CAAE,MAAOE,KAAK,CAAE,CACdH,OAAO,CAACG,KAAK,CAAC,sCAAsC,CAAEA,KAAK,CAAC,CAE5DR,sBAAsB,CAAC,IAAI,CAAC,CAC9B,CACF,CAAC,iBAnBK,CAAAE,kBAAkBA,CAAA,SAAAC,IAAA,CAAAM,KAAA,MAAAC,SAAA,OAmBvB,CAEDR,kBAAkB,CAAC,CAAC,CAGpB,MAAO,WAAM,CACXG,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAC,CAC5C1B,cAAc,CAAC+B,UAAU,CAAC,CAAC,CAACC,KAAK,CAAC,SAACC,GAAG,CAAK,CACzCR,OAAO,CAACG,KAAK,CAAC,6CAA6C,CAAEK,GAAG,CAAC,CACnE,CAAC,CAAC,CACJ,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAGN5C,KAAK,CAACgC,SAAS,CAAC,UAAM,CACpB,GAAIF,mBAAmB,CAAE,CACvBP,SAAS,CAAC,CAAC,CACb,CACF,CAAC,CAAE,CAACO,mBAAmB,CAAC,CAAC,CAGzB9B,KAAK,CAACgC,SAAS,CAAC,UAAM,CACpB,GAAIP,eAAe,EAAID,IAAI,CAAE,CAE3Bd,cAAc,CAACmC,OAAO,CAAC,CACrBC,EAAE,CAAEtB,IAAI,CAACsB,EAAE,CACXC,KAAK,CAAEvB,IAAI,CAACuB,KAAK,CACjBC,QAAQ,CAAExB,IAAI,CAACyB,IAAI,CACnBA,IAAI,CAAEzB,IAAI,CAACyB,IACb,CAAC,CAAC,CACFb,OAAO,CAACC,GAAG,CAAC,6CAA6C,CAAEb,IAAI,CAACuB,KAAK,CAAC,CACxE,CAAC,IAAM,CAELrC,cAAc,CAACwC,SAAS,CAAC,CAAC,CAC1Bd,OAAO,CAACC,GAAG,CAAC,gDAAgD,CAAC,CAC/D,CACF,CAAC,CAAE,CAACZ,eAAe,CAAED,IAAI,CAAC,CAAC,CAE3B,MACE,CAAAX,IAAA,CAACJ,aAAa,EAAC0C,aAAa,CAAC,KAAK,CAAAC,QAAA,CAChCvC,IAAA,CAACR,sBAAsB,EAACgD,KAAK,CAAE,CAAEC,IAAI,CAAE,CAAE,CAAE,CAAAF,QAAA,CACzCvC,IAAA,CAACT,mBAAmB,EAACmD,MAAM,CAAEvC,WAAY,CAAAoC,QAAA,CACvCvC,IAAA,CAACX,gBAAgB,EAAAkD,QAAA,CACfrC,KAAA,CAACT,mBAAmB,EAAA8C,QAAA,EAClBvC,IAAA,CAACZ,SAAS,EAACoD,KAAK,CAAC,MAAM,CAAE,CAAC,CAC1BxC,IAAA,CAACN,aAAa,GAAE,CAAC,EACE,CAAC,CACN,CAAC,CACA,CAAC,CACA,CAAC,CACZ,CAAC,CAEpB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}