{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Broxiva GitHub Secrets Schema",
  "description": "Schema documenting required GitHub Actions secrets per environment",
  "type": "object",
  "definitions": {
    "secret": {
      "type": "object",
      "properties": {
        "name": { "type": "string" },
        "description": { "type": "string" },
        "required": { "type": "boolean" },
        "environments": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["dev", "staging", "prod", "all"]
          }
        },
        "usedIn": {
          "type": "array",
          "items": { "type": "string" }
        },
        "format": { "type": "string" },
        "rotationPolicy": { "type": "string" }
      },
      "required": ["name", "description", "required", "environments"]
    }
  },
  "properties": {
    "azure": {
      "type": "object",
      "description": "Azure authentication secrets for OIDC",
      "properties": {
        "secrets": {
          "type": "array",
          "items": { "$ref": "#/definitions/secret" }
        }
      }
    },
    "database": {
      "type": "object",
      "description": "Database connection secrets",
      "properties": {
        "secrets": {
          "type": "array",
          "items": { "$ref": "#/definitions/secret" }
        }
      }
    },
    "terraform": {
      "type": "object",
      "description": "Terraform backend secrets",
      "properties": {
        "secrets": {
          "type": "array",
          "items": { "$ref": "#/definitions/secret" }
        }
      }
    },
    "notifications": {
      "type": "object",
      "description": "Notification service secrets",
      "properties": {
        "secrets": {
          "type": "array",
          "items": { "$ref": "#/definitions/secret" }
        }
      }
    },
    "build": {
      "type": "object",
      "description": "Build and CI secrets",
      "properties": {
        "secrets": {
          "type": "array",
          "items": { "$ref": "#/definitions/secret" }
        }
      }
    },
    "security": {
      "type": "object",
      "description": "Security scanning secrets",
      "properties": {
        "secrets": {
          "type": "array",
          "items": { "$ref": "#/definitions/secret" }
        }
      }
    }
  },
  "secrets": {
    "azure": {
      "secrets": [
        {
          "name": "AZURE_CLIENT_ID",
          "description": "Azure AD Application (client) ID for OIDC authentication",
          "required": true,
          "environments": ["all"],
          "usedIn": ["cd-dev.yml", "cd-staging.yml", "cd-prod.yml", "drift-detection.yml", "build-and-push-acr.yml"],
          "format": "UUID (xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx)",
          "rotationPolicy": "On compromise only"
        },
        {
          "name": "AZURE_TENANT_ID",
          "description": "Azure AD Tenant (directory) ID",
          "required": true,
          "environments": ["all"],
          "usedIn": ["cd-dev.yml", "cd-staging.yml", "cd-prod.yml", "drift-detection.yml", "build-and-push-acr.yml"],
          "format": "UUID",
          "rotationPolicy": "Static"
        },
        {
          "name": "AZURE_SUBSCRIPTION_ID",
          "description": "Azure Subscription ID",
          "required": true,
          "environments": ["all"],
          "usedIn": ["cd-dev.yml", "cd-staging.yml", "cd-prod.yml", "drift-detection.yml", "build-and-push-acr.yml"],
          "format": "UUID",
          "rotationPolicy": "Static"
        }
      ]
    },
    "database": {
      "secrets": [
        {
          "name": "DEV_DATABASE_URL",
          "description": "PostgreSQL connection string for development environment",
          "required": true,
          "environments": ["dev"],
          "usedIn": ["cd-dev.yml"],
          "format": "postgresql://user:password@host:port/database",
          "rotationPolicy": "90 days"
        },
        {
          "name": "STAGING_DATABASE_URL",
          "description": "PostgreSQL connection string for staging environment",
          "required": true,
          "environments": ["staging"],
          "usedIn": ["cd-staging.yml"],
          "format": "postgresql://user:password@host:port/database",
          "rotationPolicy": "90 days"
        },
        {
          "name": "PROD_DATABASE_URL",
          "description": "PostgreSQL connection string for production environment",
          "required": true,
          "environments": ["prod"],
          "usedIn": ["cd-prod.yml"],
          "format": "postgresql://user:password@host:port/database",
          "rotationPolicy": "30 days"
        }
      ]
    },
    "terraform": {
      "secrets": [
        {
          "name": "TF_STATE_RESOURCE_GROUP",
          "description": "Azure resource group containing Terraform state storage",
          "required": true,
          "environments": ["all"],
          "usedIn": ["drift-detection.yml", "drift-repair.yml"],
          "rotationPolicy": "Static"
        },
        {
          "name": "TF_STATE_STORAGE_ACCOUNT",
          "description": "Azure storage account for Terraform state",
          "required": true,
          "environments": ["all"],
          "usedIn": ["drift-detection.yml", "drift-repair.yml"],
          "rotationPolicy": "Static"
        },
        {
          "name": "TF_STATE_CONTAINER",
          "description": "Azure blob container for Terraform state files",
          "required": true,
          "environments": ["all"],
          "usedIn": ["drift-detection.yml", "drift-repair.yml"],
          "rotationPolicy": "Static"
        }
      ]
    },
    "notifications": {
      "secrets": [
        {
          "name": "SLACK_WEBHOOK_URL",
          "description": "Slack incoming webhook for general notifications",
          "required": false,
          "environments": ["all"],
          "usedIn": ["cd-dev.yml", "cd-staging.yml", "cd-prod.yml", "drift-detection.yml"],
          "rotationPolicy": "On compromise"
        },
        {
          "name": "SLACK_SECURITY_WEBHOOK",
          "description": "Slack webhook for security-related alerts",
          "required": false,
          "environments": ["all"],
          "usedIn": ["sast.yml", "secret-scan.yml", "container-scan.yml"],
          "rotationPolicy": "On compromise"
        },
        {
          "name": "TEAMS_WEBHOOK_URL",
          "description": "Microsoft Teams webhook for notifications",
          "required": false,
          "environments": ["all"],
          "usedIn": ["drift-detection.yml"],
          "rotationPolicy": "On compromise"
        },
        {
          "name": "TEAMS_SECURITY_WEBHOOK",
          "description": "Microsoft Teams webhook for security alerts",
          "required": false,
          "environments": ["all"],
          "usedIn": ["sast.yml", "compliance-check.yml"],
          "rotationPolicy": "On compromise"
        }
      ]
    },
    "build": {
      "secrets": [
        {
          "name": "TURBO_TOKEN",
          "description": "Turborepo remote cache authentication token",
          "required": false,
          "environments": ["all"],
          "usedIn": ["ci.yml"],
          "rotationPolicy": "90 days"
        },
        {
          "name": "TURBO_TEAM",
          "description": "Turborepo team name for remote caching",
          "required": false,
          "environments": ["all"],
          "usedIn": ["ci.yml"],
          "rotationPolicy": "Static"
        }
      ]
    },
    "security": {
      "secrets": [
        {
          "name": "GITLEAKS_LICENSE",
          "description": "Gitleaks enterprise license key",
          "required": false,
          "environments": ["all"],
          "usedIn": ["secret-scan.yml"],
          "rotationPolicy": "Annual"
        },
        {
          "name": "SNYK_TOKEN",
          "description": "Snyk API token for dependency scanning",
          "required": false,
          "environments": ["all"],
          "usedIn": ["dependency-scan.yml"],
          "rotationPolicy": "90 days"
        }
      ]
    }
  }
}
