{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Broxiva Environment Variables Schema",
  "description": "Schema for validating environment variables across all environments",
  "type": "object",
  "definitions": {
    "base": {
      "type": "object",
      "properties": {
        "NODE_ENV": {
          "type": "string",
          "enum": ["development", "staging", "production"],
          "description": "Node.js environment"
        },
        "PORT": {
          "type": "integer",
          "minimum": 1,
          "maximum": 65535,
          "default": 4000,
          "description": "API server port"
        },
        "API_BASE_URL": {
          "type": "string",
          "format": "uri",
          "description": "Base URL for the API"
        },
        "WEB_BASE_URL": {
          "type": "string",
          "format": "uri",
          "description": "Base URL for the web app"
        },
        "DATABASE_URL": {
          "type": "string",
          "description": "PostgreSQL connection string"
        },
        "REDIS_URL": {
          "type": "string",
          "description": "Redis connection string"
        },
        "JWT_SECRET": {
          "type": "string",
          "minLength": 32,
          "description": "Secret for JWT signing"
        },
        "JWT_EXPIRES_IN": {
          "type": "string",
          "default": "7d",
          "description": "JWT expiration time"
        }
      },
      "required": ["NODE_ENV", "DATABASE_URL", "REDIS_URL", "JWT_SECRET"]
    },
    "azure": {
      "type": "object",
      "properties": {
        "AZURE_STORAGE_CONNECTION_STRING": {
          "type": "string",
          "description": "Azure Blob Storage connection string"
        },
        "AZURE_STORAGE_CONTAINER": {
          "type": "string",
          "description": "Azure Blob Storage container name"
        },
        "AZURE_KEY_VAULT_URL": {
          "type": "string",
          "format": "uri",
          "description": "Azure Key Vault URL"
        }
      }
    },
    "payments": {
      "type": "object",
      "properties": {
        "STRIPE_SECRET_KEY": {
          "type": "string",
          "pattern": "^sk_(test|live)_[a-zA-Z0-9]+$",
          "description": "Stripe API secret key"
        },
        "STRIPE_WEBHOOK_SECRET": {
          "type": "string",
          "pattern": "^whsec_[a-zA-Z0-9]+$",
          "description": "Stripe webhook signing secret"
        },
        "STRIPE_PUBLISHABLE_KEY": {
          "type": "string",
          "pattern": "^pk_(test|live)_[a-zA-Z0-9]+$",
          "description": "Stripe publishable key"
        },
        "PAYSTACK_SECRET_KEY": {
          "type": "string",
          "pattern": "^sk_(test|live)_[a-zA-Z0-9]+$",
          "description": "Paystack API secret key"
        },
        "PAYSTACK_WEBHOOK_SECRET": {
          "type": "string",
          "description": "Paystack webhook secret"
        },
        "FLUTTERWAVE_SECRET_KEY": {
          "type": "string",
          "pattern": "^FLWSECK_(TEST|LIVE)-[a-zA-Z0-9]+$",
          "description": "Flutterwave API secret key"
        },
        "FLUTTERWAVE_WEBHOOK_SECRET": {
          "type": "string",
          "description": "Flutterwave webhook secret"
        }
      }
    },
    "email": {
      "type": "object",
      "properties": {
        "SMTP_HOST": {
          "type": "string",
          "description": "SMTP server hostname"
        },
        "SMTP_PORT": {
          "type": "integer",
          "default": 587,
          "description": "SMTP server port"
        },
        "SMTP_USER": {
          "type": "string",
          "description": "SMTP username"
        },
        "SMTP_PASSWORD": {
          "type": "string",
          "description": "SMTP password"
        },
        "EMAIL_FROM": {
          "type": "string",
          "format": "email",
          "description": "Default sender email"
        }
      }
    },
    "observability": {
      "type": "object",
      "properties": {
        "SENTRY_DSN": {
          "type": "string",
          "format": "uri",
          "description": "Sentry Data Source Name"
        },
        "LOG_LEVEL": {
          "type": "string",
          "enum": ["error", "warn", "info", "debug", "trace"],
          "default": "info",
          "description": "Logging level"
        },
        "OTEL_EXPORTER_OTLP_ENDPOINT": {
          "type": "string",
          "format": "uri",
          "description": "OpenTelemetry collector endpoint"
        }
      }
    },
    "ai": {
      "type": "object",
      "properties": {
        "OPENAI_API_KEY": {
          "type": "string",
          "pattern": "^sk-[a-zA-Z0-9]+$",
          "description": "OpenAI API key"
        },
        "ANTHROPIC_API_KEY": {
          "type": "string",
          "pattern": "^sk-ant-[a-zA-Z0-9]+$",
          "description": "Anthropic API key"
        }
      }
    }
  },
  "allOf": [
    { "$ref": "#/definitions/base" },
    { "$ref": "#/definitions/azure" },
    { "$ref": "#/definitions/payments" },
    { "$ref": "#/definitions/email" },
    { "$ref": "#/definitions/observability" },
    { "$ref": "#/definitions/ai" }
  ]
}
