# Network Policy Inventory for Broxiva Platform
# Generated: 2026-01-05
# This file documents all network policies across namespaces

---
# NAMESPACE: broxiva (Base)
# Default Deny Policies + Allow Rules

# Policy List:
# 1. default-deny-ingress - Blocks all incoming traffic
# 2. default-deny-egress - Blocks all outgoing traffic  
# 3. allow-dns - DNS resolution (kube-system:53)
# 4. allow-web-to-api - Web to API (port 3000/4000)
# 5. allow-ingress-to-web - Ingress controller to Web
# 6. allow-api-to-postgres - API to PostgreSQL (5432)
# 7. allow-api-to-redis - API to Redis (6379)
# 8. allow-api-to-elasticsearch - API to ES (9200, 9300)
# 9. allow-prometheus-scraping - Prometheus to exporters
# 10. allow-api-external-egress - API to external (443, 587)
# 11. isolate-postgres - PostgreSQL DNS only egress
# 12. isolate-redis - Redis DNS only egress
# 13. isolate-elasticsearch - ES DNS only egress
# 14. allow-web-to-ai - Web to AI services namespace

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-ingress
  namespace: broxiva
spec:
  podSelector: {}
  policyTypes:
    - Ingress

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-egress
  namespace: broxiva
spec:
  podSelector: {}
  policyTypes:
    - Egress

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-dns
  namespace: broxiva
spec:
  podSelector: {}
  policyTypes:
    - Egress
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              name: kube-system
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-api-to-postgres
  namespace: broxiva
spec:
  podSelector:
    matchLabels:
      app: postgres
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: broxiva-api
      ports:
        - protocol: TCP
          port: 5432

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-api-to-redis
  namespace: broxiva
spec:
  podSelector:
    matchLabels:
      app: redis
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: broxiva-api
      ports:
        - protocol: TCP
          port: 6379

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: isolate-postgres
  namespace: broxiva
spec:
  podSelector:
    matchLabels:
      app: postgres
  policyTypes:
    - Egress
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              name: kube-system
      ports:
        - protocol: UDP
          port: 53

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: isolate-redis
  namespace: broxiva
spec:
  podSelector:
    matchLabels:
      app: redis
  policyTypes:
    - Egress
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              name: kube-system
      ports:
        - protocol: UDP
          port: 53

---
# SUMMARY:
# - Zero-trust model implemented with default deny
# - DNS allowed for all pods
# - API allowed to databases (postgres, redis, elasticsearch)
# - Databases isolated with DNS-only egress
# - External egress only for API (payment/email)
# - Prometheus allowed to scrape metrics
# - Cross-namespace allowed only where needed
