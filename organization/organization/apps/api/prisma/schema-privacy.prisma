// Privacy and Consent Tracking Models for GDPR/CCPA Compliance
// This file contains models for managing user consent, data deletion, exports, and agreed terms

// Consent Log - Track user consent for GDPR Article 7
model ConsentLog {
  id        String   @id @default(uuid())
  userId    String

  // Consent Categories
  dataProcessing    Boolean @default(true)  // Required for account functionality
  marketing         Boolean @default(false) // Marketing communications
  analytics         Boolean @default(false) // Analytics and tracking
  thirdPartySharing Boolean @default(false) // Sharing data with third parties

  // Audit Trail
  ipAddress String?
  userAgent String?
  version   String  @default("1.0") // Privacy policy version

  createdAt DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@map("consent_logs")
}

// Data Deletion Requests - Track GDPR Article 17 / CCPA Section 1798.105 requests
model DataDeletionRequest {
  id       String   @id @default(uuid())
  userId   String

  // Deletion Details
  strategy      String // SOFT_DELETE, HARD_DELETE, ANONYMIZE
  reason        String?
  status        DeletionStatus @default(PENDING)
  scheduledDate DateTime
  completedAt   DateTime?

  // Cancellation Grace Period
  cancellationDeadline DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([scheduledDate])
  @@map("data_deletion_requests")
}

// Data Export Requests - Track GDPR Article 20 / CCPA Section 1798.110 requests
model DataExportRequest {
  id       String   @id @default(uuid())
  userId   String

  // Export Details
  format      String // json, csv
  status      ExportStatus @default(PENDING)
  downloadUrl String?
  expiresAt   DateTime?
  completedAt DateTime?

  // File Information
  fileSize    Int?    // Size in bytes
  recordCount Int?    // Number of records exported

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([expiresAt])
  @@map("data_export_requests")
}

// Agreed Terms - Track which version of terms/privacy policy user agreed to
model AgreedTerms {
  id       String   @id @default(uuid())
  userId   String

  // Document Versions
  termsVersion          String
  privacyPolicyVersion  String
  cookiePolicyVersion   String?

  // Audit Trail
  ipAddress String?
  userAgent String?
  agreedAt  DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([agreedAt])
  @@map("agreed_terms")
}

// Enums for Privacy Models
enum DeletionStatus {
  PENDING
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  FAILED
}

enum ExportStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  EXPIRED
}

// Add these relations to the User model:
// - consentLogs           ConsentLog[]
// - dataDeletionRequests  DataDeletionRequest[]
// - dataExportRequests    DataExportRequest[]
// - agreedTerms           AgreedTerms[]
// - deletedAt             DateTime?
// - processingRestricted  Boolean @default(false)
