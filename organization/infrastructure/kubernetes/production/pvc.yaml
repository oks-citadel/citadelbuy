# PersistentVolumeClaims for Broxiva Production Environment

---
# PVC for PostgreSQL Primary Data
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: postgres-primary-pvc
  namespace: broxiva-production
  labels:
    app: postgres
    tier: database
    environment: production
    role: primary
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 100Gi
  storageClassName: gp3  # High-performance storage
  # volumeMode: Filesystem

---
# PVC for PostgreSQL Replica 1 (for HA setup)
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: postgres-replica-1-pvc
  namespace: broxiva-production
  labels:
    app: postgres
    tier: database
    environment: production
    role: replica
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 100Gi
  storageClassName: gp3

---
# PVC for Redis Master Data
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: redis-master-pvc
  namespace: broxiva-production
  labels:
    app: redis
    tier: cache
    environment: production
    role: master
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 20Gi
  storageClassName: gp3

---
# PVC for Redis Replica 1
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: redis-replica-1-pvc
  namespace: broxiva-production
  labels:
    app: redis
    tier: cache
    environment: production
    role: replica
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 20Gi
  storageClassName: gp3

---
# PVC for Elasticsearch Master Node 1
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: elasticsearch-master-1-pvc
  namespace: broxiva-production
  labels:
    app: elasticsearch
    tier: search
    environment: production
    role: master
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 50Gi
  storageClassName: gp3

---
# PVC for Elasticsearch Data Node 1
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: elasticsearch-data-1-pvc
  namespace: broxiva-production
  labels:
    app: elasticsearch
    tier: search
    environment: production
    role: data
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 200Gi
  storageClassName: gp3

---
# PVC for Elasticsearch Data Node 2
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: elasticsearch-data-2-pvc
  namespace: broxiva-production
  labels:
    app: elasticsearch
    tier: search
    environment: production
    role: data
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 200Gi
  storageClassName: gp3

---
# PVC for Application Logs (if needed)
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: application-logs-pvc
  namespace: broxiva-production
  labels:
    app: broxiva
    tier: logging
    environment: production
spec:
  accessModes:
    - ReadWriteMany  # Multiple pods can write logs
  resources:
    requests:
      storage: 50Gi
  storageClassName: efs  # Use EFS or similar for shared storage

---
# VolumeSnapshot for Database Backup
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshot
metadata:
  name: postgres-backup-snapshot
  namespace: broxiva-production
  labels:
    app: postgres
    tier: database
    environment: production
    backup: "true"
spec:
  volumeSnapshotClassName: csi-aws-vsc
  source:
    persistentVolumeClaimName: postgres-primary-pvc

---
# PRODUCTION STORAGE REQUIREMENTS:
#
# 1. PERFORMANCE:
#    - Use gp3 (AWS), premium-rwo (GCP), or premium SSD (Azure) for production databases
#    - IOPS: Minimum 3000 for databases, 6000+ for high-traffic applications
#    - Throughput: Minimum 125 MB/s per volume
#
# 2. BACKUP & DISASTER RECOVERY:
#    - Enable automated snapshots every 6 hours
#    - Retain snapshots for 30 days minimum
#    - Store backups in different region/availability zone
#    - Test restore procedures monthly
#    - Implement point-in-time recovery (PITR) for databases
#
# 3. HIGH AVAILABILITY:
#    - Use StatefulSets with anti-affinity for database replicas
#    - Deploy across multiple availability zones
#    - Configure automatic failover
#    - Monitor replication lag (should be <5 seconds)
#
# 4. MONITORING:
#    - Track volume usage and set alerts at 80% capacity
#    - Monitor IOPS and throughput metrics
#    - Alert on snapshot failures
#    - Track read/write latency
#
# 5. SECURITY:
#    - Enable encryption at rest for all PVCs
#    - Use encrypted storage classes
#    - Implement RBAC for volume access
#    - Regular security audits
#
# 6. CAPACITY PLANNING:
#    - Review storage growth trends quarterly
#    - Plan for 30% buffer capacity
#    - Archive old data to object storage (S3, GCS, etc.)
#    - Implement data lifecycle policies
#
# 7. COST OPTIMIZATION:
#    - Use appropriate storage tiers based on access patterns
#    - Implement data archival strategies
#    - Clean up unused snapshots
#    - Consider using cloud-native managed databases for critical workloads
#
# Storage Class Examples by Cloud Provider:
#
# AWS EKS:
# - gp3: General purpose SSD (default, 3000 IOPS baseline)
# - io2: Provisioned IOPS SSD (high performance, up to 64000 IOPS)
# - efs: Elastic File System (shared storage, ReadWriteMany)
#
# GCP GKE:
# - standard-rwo: Standard persistent disk
# - premium-rwo: SSD persistent disk (high performance)
# - filestore: Managed NFS (shared storage)
#
# Azure AKS:
# - managed-premium: Premium SSD
# - azurefile-premium: Premium Azure Files (shared storage)
# - ultra-disk: Ultra Disk Storage (highest performance)
