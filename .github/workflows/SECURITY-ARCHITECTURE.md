# Security Scanning Architecture

## System Overview

```
┌─────────────────────────────────────────────────────────────────────┐
│                    GitHub Repository Events                          │
│  (Push to main/develop, Pull Request, Weekly Schedule, Manual)      │
└────────────────────────┬────────────────────────────────────────────┘
                         │
                         ▼
        ┌────────────────────────────────────────────┐
        │     GitHub Actions Workflow Engine         │
        └────────────────────────────────────────────┘
                         │
         ┌───────────────┴───────────────┐
         │                               │
         ▼                               ▼
┌─────────────────┐            ┌─────────────────┐
│  PR Blocking    │            │   Reporting     │
│   Workflows     │            │   Workflows     │
└─────────────────┘            └─────────────────┘
         │                               │
         ├─────────────────┬─────────────┼─────────────────┬────────────┐
         ▼                 ▼             ▼                 ▼            ▼
    ┌────────┐      ┌──────────┐   ┌────────┐     ┌──────────┐  ┌──────────┐
    │  SAST  │      │Dependency│   │Container│     │   API    │  │Compliance│
    │        │      │   Scan   │   │  Scan  │     │ Security │  │  Check   │
    └────────┘      └──────────┘   └────────┘     └──────────┘  └──────────┘
         │                 │             │                │            │
         └─────────────────┴─────────────┴────────────────┴────────────┘
                                     │
                    ┌────────────────┴────────────────┐
                    ▼                                 ▼
          ┌──────────────────┐              ┌─────────────────┐
          │ Secret Detection │              │ Results Upload  │
          └──────────────────┘              └─────────────────┘
                    │                                 │
                    │                    ┌────────────┴──────────────┐
                    │                    │                           │
                    ▼                    ▼                           ▼
          ┌──────────────────┐  ┌─────────────────┐      ┌──────────────────┐
          │  Block PR if     │  │ GitHub Security │      │    Artifacts     │
          │ Secrets Found    │  │  Tab (SARIF)    │      │  (JSON/HTML/MD)  │
          └──────────────────┘  └─────────────────┘      └──────────────────┘
                    │                    │                           │
                    │                    ▼                           │
                    │          ┌──────────────────┐                 │
                    │          │  Notifications   │◄────────────────┘
                    │          │ (Slack/Teams)    │
                    │          └──────────────────┘
                    │
                    ▼
          ┌──────────────────┐
          │ Vulnerability    │
          │ Trend Tracking   │
          └──────────────────┘
```

## Workflow Details

### 1. SAST (Static Application Security Testing)

```
┌───────────────────────────────────────────┐
│         sast.yml Workflow                 │
├───────────────────────────────────────────┤
│                                           │
│  ┌─────────────────────────────────┐    │
│  │ CodeQL Analysis (parallel)      │    │
│  │  - JavaScript scanning          │    │
│  │  - TypeScript scanning          │    │
│  │  - Security & quality queries   │    │
│  └─────────────────────────────────┘    │
│                                           │
│  ┌─────────────────────────────────┐    │
│  │ Semgrep Analysis                │    │
│  │  - OWASP Top 10 rules          │    │
│  │  - Security audit rules         │    │
│  │  - Custom patterns              │    │
│  └─────────────────────────────────┘    │
│                                           │
│  ┌─────────────────────────────────┐    │
│  │ ESLint Security                 │    │
│  │  - Security plugin rules        │    │
│  │  - No-secrets detection         │    │
│  └─────────────────────────────────┘    │
│                                           │
│  ┌─────────────────────────────────┐    │
│  │ Result Processing               │    │
│  │  - SARIF upload to Security tab │    │
│  │  - Severity filtering           │    │
│  │  - Report generation            │    │
│  └─────────────────────────────────┘    │
│                                           │
│  ┌─────────────────────────────────┐    │
│  │ PR Blocking Logic               │    │
│  │  - Block if Critical/High found │    │
│  │  - Comment on PR with details   │    │
│  └─────────────────────────────────┘    │
└───────────────────────────────────────────┘
```

### 2. Dependency Vulnerability Scanning

```
┌───────────────────────────────────────────┐
│    dependency-scan.yml Workflow           │
├───────────────────────────────────────────┤
│                                           │
│  ┌─────────────────────────────────┐    │
│  │ NPM Audit                       │    │
│  │  - Built-in vulnerability DB    │    │
│  │  - Fix suggestions              │    │
│  └─────────────────────────────────┘    │
│           │                              │
│           ├─────────────────┐            │
│           ▼                 ▼            │
│  ┌──────────────┐  ┌──────────────┐    │
│  │ Snyk Scan    │  │ OSV Scanner  │    │
│  │ (optional)   │  │ (Google)     │    │
│  └──────────────┘  └──────────────┘    │
│           │                 │            │
│           └────────┬────────┘            │
│                    ▼                     │
│  ┌─────────────────────────────────┐    │
│  │ License Compliance Check        │    │
│  │  - Approved licenses            │    │
│  │  - Restricted license detection │    │
│  └─────────────────────────────────┘    │
│                    │                     │
│                    ▼                     │
│  ┌─────────────────────────────────┐    │
│  │ Dependency Graph Analysis       │    │
│  │  - Transitive dependencies      │    │
│  │  - Outdated packages            │    │
│  └─────────────────────────────────┘    │
│                    │                     │
│                    ▼                     │
│  ┌─────────────────────────────────┐    │
│  │ Consolidated Report             │    │
│  │  - Critical/High blocking       │    │
│  │  - Remediation suggestions      │    │
│  └─────────────────────────────────┘    │
└───────────────────────────────────────────┘
```

### 3. Container Security Scanning

```
┌───────────────────────────────────────────┐
│     container-scan.yml Workflow           │
├───────────────────────────────────────────┤
│                                           │
│  ┌─────────────────────────────────┐    │
│  │ Build Docker Image              │    │
│  │  - Use Buildx for caching       │    │
│  │  - Export as tarball            │    │
│  └─────────────────────────────────┘    │
│           │                              │
│           ├──────────────────────┐       │
│           ▼                      ▼       │
│  ┌──────────────┐       ┌──────────────┐│
│  │ Trivy Scan   │       │ Grype Scan   ││
│  │ - OS vulns   │       │ - Package    ││
│  │ - Packages   │       │   vulns      ││
│  └──────────────┘       └──────────────┘│
│           │                      │       │
│           ├──────────┬───────────┘       │
│           │          │                   │
│           ▼          ▼                   │
│  ┌──────────────┐ ┌──────────────┐     │
│  │ Hadolint     │ │ Dockle       │     │
│  │ - Dockerfile │ │ - Image      │     │
│  │   linting    │ │   best       │     │
│  │              │ │   practices  │     │
│  └──────────────┘ └──────────────┘     │
│           │          │                   │
│           ├──────────┴────┐              │
│           │               │              │
│           ▼               ▼              │
│  ┌──────────────┐  ┌──────────────┐    │
│  │ Trivy Config │  │ Docker Bench │    │
│  │ - IaC scan   │  │ - CIS check  │    │
│  └──────────────┘  └──────────────┘    │
│           │               │              │
│           └───────┬───────┘              │
│                   ▼                      │
│  ┌─────────────────────────────────┐    │
│  │ Result Aggregation              │    │
│  │  - SARIF upload                 │    │
│  │  - Critical vuln blocking       │    │
│  └─────────────────────────────────┘    │
└───────────────────────────────────────────┘
```

### 4. Secret Detection

```
┌───────────────────────────────────────────┐
│      secret-scan.yml Workflow             │
├───────────────────────────────────────────┤
│                                           │
│  ┌─────────────────────────────────┐    │
│  │ Gitleaks                        │    │
│  │  - Git history scan             │    │
│  │  - Pattern matching             │    │
│  │  - High entropy detection       │    │
│  └─────────────────────────────────┘    │
│           │                              │
│           ├──────────────────────┐       │
│           ▼                      ▼       │
│  ┌──────────────┐       ┌──────────────┐│
│  │ TruffleHog   │       │ Detect-      ││
│  │ - Verified   │       │ Secrets      ││
│  │   secrets    │       │ - Patterns   ││
│  └──────────────┘       └──────────────┘│
│           │                      │       │
│           ├──────────┬───────────┘       │
│           │          │                   │
│           ▼          ▼                   │
│  ┌──────────────┐ ┌──────────────┐     │
│  │ Secretlint   │ │ Git-Secrets  │     │
│  │ - Custom     │ │ - AWS        │     │
│  │   rules      │ │   patterns   │     │
│  └──────────────┘ └──────────────┘     │
│           │          │                   │
│           ├──────────┴────┐              │
│           │               │              │
│           ▼               ▼              │
│  ┌──────────────┐  ┌──────────────┐    │
│  │ Env File     │  │ Result       │    │
│  │ Check        │  │ Analysis     │    │
│  └──────────────┘  └──────────────┘    │
│           │               │              │
│           └───────┬───────┘              │
│                   ▼                      │
│  ┌─────────────────────────────────┐    │
│  │ IMMEDIATE PR BLOCKING           │    │
│  │  - ANY secret found = BLOCK     │    │
│  │  - Alert security team          │    │
│  │  - Remediation instructions     │    │
│  └─────────────────────────────────┘    │
└───────────────────────────────────────────┘
```

### 5. API Security Testing

```
┌───────────────────────────────────────────┐
│   api-security-test.yml Workflow          │
├───────────────────────────────────────────┤
│                                           │
│  ┌─────────────────────────────────┐    │
│  │ Setup Test Environment          │    │
│  │  - Start application            │    │
│  │  - Wait for health check        │    │
│  └─────────────────────────────────┘    │
│           │                              │
│           ├──────────────────────┐       │
│           ▼                      ▼       │
│  ┌──────────────┐       ┌──────────────┐│
│  │ OWASP ZAP    │       │ OWASP ZAP    ││
│  │ Baseline     │       │ API Scan     ││
│  │ Scan         │       │ (OpenAPI)    ││
│  └──────────────┘       └──────────────┘│
│           │                      │       │
│           ├──────────┬───────────┘       │
│           │          │                   │
│           ▼          ▼                   │
│  ┌──────────────┐ ┌──────────────┐     │
│  │ API Fuzzing  │ │ Auth Testing │     │
│  │ - Malicious  │ │ - Bypass     │     │
│  │   payloads   │ │   attempts   │     │
│  └──────────────┘ └──────────────┘     │
│           │          │                   │
│           ├──────────┴────┐              │
│           │               │              │
│           ▼               ▼              │
│  ┌──────────────┐  ┌──────────────┐    │
│  │ Rate Limit   │  │ Input        │    │
│  │ Testing      │  │ Validation   │    │
│  └──────────────┘  └──────────────┘    │
│           │               │              │
│           └───────┬───────┘              │
│                   ▼                      │
│  ┌─────────────────────────────────┐    │
│  │ Security Report Generation      │    │
│  │  - OWASP API Top 10 mapping     │    │
│  │  - Remediation guidance         │    │
│  └─────────────────────────────────┘    │
└───────────────────────────────────────────┘
```

### 6. Compliance Validation

```
┌───────────────────────────────────────────┐
│    compliance-check.yml Workflow          │
├───────────────────────────────────────────┤
│                                           │
│  ┌─────────────────────────────────┐    │
│  │ OWASP Top 10 2021               │    │
│  │  - A01: Broken Access Control   │    │
│  │  - A02: Cryptographic Failures  │    │
│  │  - A03: Injection               │    │
│  │  - ... (all 10 categories)      │    │
│  └─────────────────────────────────┘    │
│           │                              │
│           ├──────────────────────┐       │
│           ▼                      ▼       │
│  ┌──────────────┐       ┌──────────────┐│
│  │ CIS          │       │ PCI-DSS      ││
│  │ Benchmarks   │       │ Compliance   ││
│  │ - Docker     │       │ - Req 1-12   ││
│  │ - Node.js    │       │              ││
│  └──────────────┘       └──────────────┘│
│           │                      │       │
│           ├──────────┬───────────┘       │
│           │          │                   │
│           ▼          ▼                   │
│  ┌──────────────┐ ┌──────────────┐     │
│  │ Security     │ │ Vulnerability│     │
│  │ Headers      │ │ Trends       │     │
│  │ Validation   │ │ Analysis     │     │
│  └──────────────┘ └──────────────┘     │
│           │          │                   │
│           └──────────┴────┐              │
│                           ▼              │
│  ┌─────────────────────────────────┐    │
│  │ Compliance Report Generation    │    │
│  │  - Checklists                   │    │
│  │  - Automated validation         │    │
│  │  - Gap analysis                 │    │
│  └─────────────────────────────────┘    │
└───────────────────────────────────────────┘
```

## Data Flow Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                        Source Code Repository                    │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     Workflow Trigger Events                      │
│  • git push                                                      │
│  • pull_request                                                  │
│  • schedule (cron)                                               │
│  • workflow_dispatch (manual)                                    │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Parallel Scanning Jobs                        │
│                                                                  │
│  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐  │
│  │  SAST  │  │  Dep   │  │  Cont  │  │ Secret │  │  API   │  │
│  └────────┘  └────────┘  └────────┘  └────────┘  └────────┘  │
└─────────────────────────────────────────────────────────────────┘
       │            │            │            │            │
       └────────────┴────────────┴────────────┴────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Result Processing                           │
│                                                                  │
│  ┌──────────────────────┐    ┌──────────────────────┐         │
│  │  SARIF Conversion    │    │  Severity Analysis   │         │
│  └──────────────────────┘    └──────────────────────┘         │
│                                                                  │
│  ┌──────────────────────┐    ┌──────────────────────┐         │
│  │  Report Generation   │    │  Artifact Creation   │         │
│  └──────────────────────┘    └──────────────────────┘         │
└─────────────────────────────────────────────────────────────────┘
       │            │            │            │            │
       ├────────────┼────────────┼────────────┼────────────┤
       ▼            ▼            ▼            ▼            ▼
┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐
│ GitHub   │  │ Workflow │  │ Notif-   │  │ PR       │  │ Metrics  │
│ Security │  │ Artifacts│  │ ications │  │ Blocking │  │ Tracking │
│ Tab      │  │          │  │          │  │          │  │          │
└──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘
```

## Security Decision Flow

```
                    ┌─────────────────┐
                    │ Scan Completed  │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │ Parse Results   │
                    └────────┬────────┘
                             │
                ┌────────────┴────────────┐
                │                         │
                ▼                         ▼
       ┌─────────────────┐     ┌─────────────────┐
       │ Critical Found? │     │  High Found?    │
       └────────┬────────┘     └────────┬────────┘
                │                       │
         ┌──────┴──────┐         ┌──────┴──────┐
         │             │         │             │
        YES           NO        YES           NO
         │             │         │             │
         ▼             │         ▼             │
┌─────────────────┐    │ ┌─────────────────┐  │
│ BLOCK PR        │    │ │ WARN/BLOCK PR   │  │
│ Alert Team      │    │ │ (Configurable)  │  │
│ Create Issue    │    │ └─────────────────┘  │
└─────────────────┘    │                      │
         │             │                      │
         └─────────────┴──────────────────────┘
                       │
                       ▼
              ┌─────────────────┐
              │ Generate Report │
              └────────┬────────┘
                       │
              ┌────────┴────────┐
              │                 │
              ▼                 ▼
     ┌─────────────────┐ ┌─────────────────┐
     │ Upload to       │ │ Store as        │
     │ Security Tab    │ │ Artifact        │
     └─────────────────┘ └─────────────────┘
              │                 │
              └────────┬────────┘
                       │
                       ▼
              ┌─────────────────┐
              │ Send Notif-     │
              │ ications        │
              │ (if critical)   │
              └─────────────────┘
```

## Integration Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    External Integrations                         │
└─────────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
     ┌────────────────┐ ┌────────────┐ ┌────────────┐
     │ Slack/Teams    │ │ Snyk.io    │ │ GitHub     │
     │ Notifications  │ │ (Optional) │ │ Security   │
     └────────────────┘ └────────────┘ └────────────┘
              ▲               ▲               ▲
              │               │               │
              └───────────────┼───────────────┘
                              │
┌─────────────────────────────────────────────────────────────────┐
│                    Security Workflows                            │
└─────────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
     ┌────────────────┐ ┌────────────┐ ┌────────────┐
     │ SARIF Export   │ │ JSON       │ │ Metrics    │
     │ to Security    │ │ Reports    │ │ Export     │
     │ Tab            │ │            │ │            │
     └────────────────┘ └────────────┘ └────────────┘
```

## Notification Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                   Security Finding Detected                      │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ Severity Check  │
                    └────────┬────────┘
                             │
                ┌────────────┴────────────┐
                │                         │
        Critical/High                Medium/Low
                │                         │
                ▼                         ▼
     ┌─────────────────────┐   ┌─────────────────────┐
     │ Immediate Actions:  │   │ Standard Actions:   │
     │                     │   │                     │
     │ 1. Block PR         │   │ 1. Warning only     │
     │ 2. Alert on Slack   │   │ 2. No notifications │
     │ 3. Comment on PR    │   │ 3. Report in logs   │
     │ 4. Create Issue     │   │                     │
     └─────────────────────┘   └─────────────────────┘
                │                         │
                └─────────────┬───────────┘
                              │
                              ▼
                ┌─────────────────────────┐
                │ Update Security         │
                │ Dashboard               │
                └─────────────────────────┘
```

## Artifact Storage Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                      Scan Results Storage                        │
└─────────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
     ┌────────────────┐ ┌────────────┐ ┌────────────┐
     │ SARIF Files    │ │ JSON       │ │ HTML       │
     │ (Security Tab) │ │ Reports    │ │ Reports    │
     │                │ │            │ │            │
     │ Retention:     │ │ Retention: │ │ Retention: │
     │ Permanent      │ │ 30 days    │ │ 30 days    │
     └────────────────┘ └────────────┘ └────────────┘
              │               │               │
              └───────────────┼───────────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
     ┌────────────────┐ ┌────────────┐ ┌────────────┐
     │ Markdown       │ │ Trends     │ │ Compliance │
     │ Reports        │ │ Data       │ │ Checklists │
     │                │ │            │ │            │
     │ Retention:     │ │ Retention: │ │ Retention: │
     │ 90 days        │ │ 365 days   │ │ 90 days    │
     └────────────────┘ └────────────┘ └────────────┘
```

## Security Metrics Dashboard

```
┌─────────────────────────────────────────────────────────────────┐
│                     Security Metrics                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Vulnerability Severity Distribution                             │
│  ┌────────────────────────────────────────┐                    │
│  │ Critical: ███ 3                        │                    │
│  │ High:     ██████ 12                    │                    │
│  │ Medium:   ████████████ 24              │                    │
│  │ Low:      ████████████████ 35          │                    │
│  └────────────────────────────────────────┘                    │
│                                                                  │
│  Scan Coverage                                                   │
│  ┌────────────────────────────────────────┐                    │
│  │ Code:         ████████████████ 100%    │                    │
│  │ Dependencies: ████████████████ 100%    │                    │
│  │ Containers:   ████████████████ 100%    │                    │
│  │ Secrets:      ████████████████ 100%    │                    │
│  │ API:          ████████████     75%     │                    │
│  └────────────────────────────────────────┘                    │
│                                                                  │
│  Mean Time to Remediate (MTTR)                                   │
│  ┌────────────────────────────────────────┐                    │
│  │ Critical: 18 hours                     │                    │
│  │ High:     4 days                       │                    │
│  │ Medium:   2 weeks                      │                    │
│  └────────────────────────────────────────┘                    │
│                                                                  │
│  Compliance Status                                               │
│  ┌────────────────────────────────────────┐                    │
│  │ OWASP Top 10:  ████████████ 85%        │                    │
│  │ CIS Benchmark: ██████████   70%        │                    │
│  │ PCI-DSS:       ███████████  78%        │                    │
│  └────────────────────────────────────────┘                    │
└─────────────────────────────────────────────────────────────────┘
```

## Technology Stack

### Scanning Tools
- **CodeQL**: GitHub's semantic code analysis
- **Semgrep**: Fast static analysis
- **Trivy**: Container vulnerability scanner
- **Gitleaks**: Secret detection
- **OWASP ZAP**: API security testing
- **Snyk**: Vulnerability intelligence (optional)

### Infrastructure
- **GitHub Actions**: Workflow orchestration
- **Docker**: Container runtime
- **Node.js**: Application runtime
- **Python**: Script execution

### Reporting
- **SARIF**: Security tool output format
- **JSON**: Machine-readable reports
- **HTML**: Human-readable reports
- **Markdown**: Documentation format

---

**Last Updated**: 2025-12-10

**Architecture Version**: 1.0.0
